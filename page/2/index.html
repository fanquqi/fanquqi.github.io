<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="fanquqi.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="fanquqi.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="fanquqi.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="fanquqi.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="fanquqi.github.io/css/main.css">


<link rel="stylesheet" href="fanquqi.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fanquqi.github.io","root":"fanquqi.github.io/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Raise my flag to the new age.">
<meta property="og:type" content="website">
<meta property="og:title" content="fix u dream">
<meta property="og:url" content="https://fanquqi.github.io/page/2/index.html">
<meta property="og:site_name" content="fix u dream">
<meta property="og:description" content="Raise my flag to the new age.">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="fanquqi">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://fanquqi.github.io/page/2/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>fix u dream</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="fanquqi.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">fix u dream</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="fanquqi.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="fanquqi.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/06/05/nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/06/05/nginx%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E4%BD%BF%E7%94%A8%E7%B3%BB%E7%BB%9F%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F/" class="post-title-link" itemprop="url">nginx配置文件使用系统环境变量</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-06-05 11:24:14" itemprop="dateCreated datePublished" datetime="2018-06-05T11:24:14+08:00">2018-06-05</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/nginx/" itemprop="url" rel="index"><span itemprop="name">nginx</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>最近有HTTP服务上到docker，docker中能动态添加系统环境变量，很方便，我们也想在nginx配置文件中动态读取这些配置。以下是具体实现方法。</p>
</blockquote>
<h1 id="在nginx配置文件中使用系统环境变量"><a href="#在nginx配置文件中使用系统环境变量" class="headerlink" title="在nginx配置文件中使用系统环境变量"></a>在nginx配置文件中使用系统环境变量</h1><p>方法: 借助lua的<code>os.getenv</code> 函数</p>
<p>1, 声明变量 </p>
<pre><code>env test_path;</code></pre><p>2, 获取变量</p>
<pre><code>在server{} 模块中
# TEST_PATH 为系统环境变量
set_by_lua $test_path &apos;return os.getenv(&quot;TEST_PATH&quot;)&apos;; </code></pre><p>3, 引用变量</p>
<pre><code>access_log $test_path main;</code></pre>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/04/10/shell%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/04/10/shell%E7%9F%A5%E8%AF%86%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">shell知识总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-10 15:55:48" itemprop="dateCreated datePublished" datetime="2018-04-10T15:55:48+08:00">2018-04-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/shell/" itemprop="url" rel="index"><span itemprop="name">shell</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>shell在日常运维中还是很强大的，而且很方便。如果你目睹过大神们写的规整的shell脚本,你会感觉这不止是简单的shell命令罗列。所以简单的if while 逻辑我可能不会记录在这个文章中。</p>
</blockquote>
<h1 id="flock锁"><a href="#flock锁" class="headerlink" title="flock锁"></a>flock锁</h1><blockquote>
<p>有的时候写个监控脚本，放到cron之中，每分钟运行一次，but sometimes,会有各种情况，脚本没有一分钟没有执行完成，然后可能会造成每分钟开一个相同进程，都处于卡住的状态。时间一长可能把user process数量都占满，系统资源可能都被用了。这个时候就可以用flock锁了。</p>
</blockquote>
<p><strong>flock</strong>  是对于整个文件的建议性锁。也就是说，如果一个进程在一个文件（inode）上放了锁，那么其它进程是可以知道的。（建议性锁不强求进程遵守。）最棒的一点是，它的第一个参数是文件描述符，在此文件描述符关闭时，锁会自动释放。而当进程终止时，所有的文件描述符均会被关闭。于是，很多时候就不用考虑解锁的事情啦。</p>
<p><strong>使用方法：</strong><br>参数：</p>
<p><code>-s</code> 为共享锁，在定向为某文件的FD上设置共享锁而未释放锁的时间内，其他进程试图在定向为此文件的FD上设置独占锁的请求失败，而其他进程试图在定向为此文件的FD上设置共享锁的请求会成功。</p>
<p><code>-e</code> 为独占或排他锁，在定向为某文件的FD上设置独占锁而未释放锁的时间内，其他进程试图在定向为此文件的FD上设置共享锁或独占锁都会失败。只要未设置-s参数，此参数默认被设置。</p>
<p><code>-u</code> 手动解锁，一般情况不必须，当FD关闭时，系统会自动解锁，此参数用于脚本命令一部分需要异步执行，一部分可以同步执行的情况。</p>
<p><code>-n</code> 为非阻塞模式，当试图设置锁失败，采用非阻塞模式，直接返回1，并继续执行下面语句。<br><code>-w</code> 设置阻塞超时，当超过设置的秒数，就跳出阻塞，返回1，并继续执行下面语句。<br><code>-o</code> 必须是使用第一种格式时才可用，表示当执行command前关闭设置锁的FD，以使command的子进程不保持锁。<br><code>-c</code> 执行其后的comand。</p>
<ol>
<li><p>脚本外嵌套使用</p>
<p> flock -x /tmp/test.lock -c “cat /tmp/test”</p>
</li>
<li><p>脚本内调用</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">(</span><br><span class="line">( flock -n 100</span><br><span class="line">if [ $? -eq 0 ]</span><br><span class="line">then</span><br><span class="line"># … commands executed under lock …</span><br><span class="line">) 100&gt;&#x2F;var&#x2F;lock&#x2F;mylockfile</span><br></pre></td></tr></table></figure>


<p>refer:<br><a href="https://my.oschina.net/leejun2005/blog/108656">https://my.oschina.net/leejun2005/blog/108656</a></p>
<h1 id="大小括号准确适用"><a href="#大小括号准确适用" class="headerlink" title="大小括号准确适用"></a>大小括号准确适用</h1><p><code>$()</code> 与 `` 效果一样，执行shell，获取结果，可以直接赋值到变量。</p>
<pre><code>hostname=`hostname`
hostname=$(hostname)</code></pre><p><code>${}</code>使用</p>
<ol>
<li><p>普通使用其实与$无益,但是更灵活<br>例如：<br> a=1<br> b=2<br> echo $ab 与 echo ${a}b</p>
</li>
<li><p>匹配字符</p>
</li>
</ol>
<p>以变量a=”error:19:20180410”为例</p>
<table>
<thead>
<tr>
<th>表达式</th>
<th>含义</th>
<th>结果</th>
</tr>
</thead>
<tbody><tr>
<td>${a#error:}</td>
<td>从左删除掉<strong>error:</strong></td>
<td>19:20180410</td>
</tr>
<tr>
<td>${a#*:}</td>
<td>非贪婪左删除</td>
<td>19:20180410</td>
</tr>
<tr>
<td>${a##*:}</td>
<td>贪婪左删除</td>
<td>20180410</td>
</tr>
<tr>
<td>${a%:*}</td>
<td>非贪婪右删除</td>
<td>error:19</td>
</tr>
<tr>
<td>${a%%:*}</td>
<td>贪婪右删除</td>
<td>error</td>
</tr>
</tbody></table>
<ol start="3">
<li>sed 正则匹配</li>
</ol>
<p>以PHP 版本为例，如<code>5.5.2</code> 需要只截取前面两位数字<code>5.5</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(echo &#96;php -version | head -n 1 | awk &#39;&#123;print $2&#125;&#39;&#96; | sed &#39;s&#x2F;\([0-9].[0-9]\).*&#x2F;\1&#x2F;g&#39;)</span><br></pre></td></tr></table></figure>

<p><code>\1</code> 表示上一段中第一个括号里面截取的内容，如果有第二个括号，可以使用<code>\2</code>输出。</p>
<ol start="4">
<li><p>浮点数比较</p>
<p> if [ $(echo “$mya &lt;= 4”|bc) = 1 ]; then echo “ok”;else echo “fail”;fi  </p>
</li>
<li><p>json处理</p>
<p> 使用<code>jq</code>工具会使shell处理json 事半功倍。</p>
<p> 使用过程不赘述</p>
</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">result &#x3D; &#123;</span><br><span class="line">    &quot;errno&quot;: 0,</span><br><span class="line">    &quot;errmsg&quot;: &quot;&quot;,</span><br><span class="line">    &quot;node&quot;: &quot;host1&quot;,</span><br><span class="line">    &quot;data&quot;: [</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;cluster&quot;: &quot;bjqq&quot;,</span><br><span class="line">            &quot;cluster_type&quot;: &quot;私有集群&quot;,</span><br><span class="line">            &quot;domain&quot;: &quot;http:&#x2F;&#x2F;host2:1234&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            &quot;cluster&quot;: &quot;ruok&quot;,</span><br><span class="line">            &quot;cluster_type&quot;: &quot;私有集群&quot;,</span><br><span class="line">            &quot;domain&quot;: &quot;http:&#x2F;&#x2F;host2:8888&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">  for row in $(echo $result | $json_jq &quot;.data&quot;| jq -r &quot;.[] | @base64&quot;); do</span><br><span class="line">    _jq() &#123;</span><br><span class="line">     echo $&#123;row&#125; | base64 --decode | jq -r $&#123;1&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if [ &quot;$(_jq &#39;.cluster&#39;)&quot; &#x3D; &quot;$1&quot; ];then</span><br><span class="line">     # echo $(_jq &#39;.cluster&#39;),$1</span><br><span class="line">      km_host&#x3D;$(_jq &#39;.domain&#39;)</span><br><span class="line"></span><br><span class="line">    fi</span><br><span class="line">  done</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>expect交互输入密码</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;usr&#x2F;bin&#x2F;expect &lt;&lt; EOF</span><br><span class="line"></span><br><span class="line">    spawn service kdump propagate</span><br><span class="line">    expect &quot;password:&quot;</span><br><span class="line">    send &quot;123\r&quot;</span><br><span class="line">    expect off</span><br><span class="line"></span><br><span class="line">EOF</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>grep 查看文件重复内容</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">找出A文件中有B文件中没有的行</span><br><span class="line">grep -v -f A  B &gt; temp</span><br><span class="line"># grep 过滤两个文件相同的行</span><br><span class="line">grep -wf aaa.txt bbb.txt</span><br><span class="line"># grep 对比两个文件不同的行（b存在a不存在）</span><br><span class="line">grep -wvf aaa.txt bbb.txt</span><br></pre></td></tr></table></figure>


<ol start="8">
<li>查看进程间通讯状态</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">同机器进程之间通讯方式一般分为三种：共享内存，队列，信号</span><br><span class="line">ipcs 命令可以查看进程间通讯状态</span><br></pre></td></tr></table></figure>

<ol start="9">
<li><p>查看进程所在目录</p>
<p> pwdx pid</p>
</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/04/02/golang%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/04/02/golang%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">golang笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-04-02 11:06:37" itemprop="dateCreated datePublished" datetime="2018-04-02T11:06:37+08:00">2018-04-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/golang/" itemprop="url" rel="index"><span itemprop="name">golang</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>#golang 特性</p>
<ol>
<li>语言级别自动垃圾回收</li>
<li>丰富的内置类型（map等）</li>
<li>函数多个返回值</li>
<li>简单的错误处理</li>
<li>匿名函数，闭包</li>
<li>接口优势</li>
<li>并发编程（goroutine）</li>
</ol>
<h1 id="编译安装"><a href="#编译安装" class="headerlink" title="编译安装"></a>编译安装</h1><blockquote>
<p>操作系统:    centos 6.2<br>golang版本: 1.8.7</p>
</blockquote>
<p><strong>环境变量设置</strong></p>
<pre><code>#vim ~/.bashrc


export GOROOT=$HOME/go
export PATH=$PATH:$GOROOT/bin
export GOPATH=$HOME/App/Go_dev</code></pre><p><code>sourc</code>生效之后可以用<code>go env</code>来检查下</p>
<p>注意安装1.8版本的时候，因为编译语言从C改为了1.4版本的golang，所以需要首先安装一下go1.4</p>
<p>所以我们的步骤就是：</p>
<ol>
<li><p>go1.4安装</p>
<p> wget <a href="https://dl.google.com/go/go1.4.linux-amd64.tar.gz">https://dl.google.com/go/go1.4.linux-amd64.tar.gz</a><br> tar -zxvf go1.4.linux-amd64.tar.gz<br> mv go ~/go1.4<br> cd ~/go1.4/src &amp;&amp; ./all.bash</p>
</li>
<li><p>go1.8.7安装</p>
<p>wget <a href="https://dl.google.com/go/go1.8.7.linux-amd64.tar.gz">https://dl.google.com/go/go1.8.7.linux-amd64.tar.gz</a><br>tar -zxvf  go1.8.7.linux-amd64.tar.gz<br>mv go $GOROOT<br>cd $GOROOT/src &amp;&amp; ./all.bash </p>
<p>go env  查看环境变量</p>
</li>
</ol>
<h1 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h1><p>##变量</p>
<p><strong>定义方式</strong></p>
<p>定义方式主要有以下几种。</p>
<p><code>var name typeName</code><br><code>var name1,name2... typeName</code><br><code>var name type = typeName</code></p>
<p><code>var name1,name2 type value1,value2</code><br><code>name1,name2 := value1,value2</code></p>
<p><strong>变量类型</strong></p>
<p>整型</p>
<ul>
<li>var v1 int</li>
</ul>
<p>字符串</p>
<ul>
<li>var v2 string</li>
</ul>
<p>数组</p>
<ul>
<li>var v3 [10]int   //数组</li>
</ul>
<p>切片</p>
<ul>
<li>var v4 []int     //数组切片</li>
</ul>
<p><strong>结构体</strong></p>
<p>对结构体的使用是golang的亮点，也是重中之重，因为golang中没有class的概念。但是有的时候我们也可以把 struct 当成一个class</p>
<p>注意结构体方法分为指针接收器方法跟非指针接收器方法， 区别就是指针接收器直接改变的结构体本身，不涉及到数据复制，非指针接收器相反</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;定义</span><br><span class="line">type x struct &#123;</span><br><span class="line">    f int</span><br><span class="line">    &#125;</span><br><span class="line">            </span><br><span class="line">&#x2F;&#x2F; 匿名结构体</span><br><span class="line"></span><br><span class="line">x1:&#x3D;struct &#123;</span><br><span class="line">    f int</span><br><span class="line">    y string</span><br><span class="line">&#125;&#123;</span><br><span class="line">    5,</span><br><span class="line">    &quot;hello world&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;实例化</span><br><span class="line">var x1 x</span><br><span class="line">x1:&#x3D;x&#123;5,&quot;hello world&quot;&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 区结构体地址实例化,视为对该类型进行一次 new 的实例化操作</span><br><span class="line"></span><br><span class="line">x2:&#x3D;&amp;x&#123;&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;赋值</span><br><span class="line">x1.f&#x3D;10</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 结构体方法声明</span><br><span class="line"></span><br><span class="line">func (x1 *x) call (int)&#123;</span><br><span class="line">    fmt.Println(x1.y)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<p>map</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var map1 map[key-type] value-type</span><br></pre></td></tr></table></figure>

<p>指针</p>
<ul>
<li><p>var v6 *int //指针  &amp; 取址 *取值 </p>
</li>
<li><p>p = &amp;i   //指针</p>
</li>
<li><p>var p *int = &amp;i //指针</p>
</li>
<li><p>var p = &amp;i // 指针</p>
</li>
<li><p>p := &amp;i //指针</p>
</li>
<li><p>var v7 map[string]int  //map,key为string类型，value为int类型</p>
</li>
<li></li>
</ul>
<p>##常量</p>
<p>关键字：const<br>常量可以是bool值，数字型，或者字符串型。是编译期间就已知且不可改变的值。<br>程序运行中不会被改变。</p>
<h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><p>func (参数1 type) (return值 type){ code }</p>
<h2 id="匿名函数"><a href="#匿名函数" class="headerlink" title="匿名函数"></a>匿名函数</h2><p><strong>定义完之后直接调用</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">func (data int) &#123;</span><br><span class="line">    fmt.Println(&quot;hello&quot;, data)</span><br><span class="line">&#125; (100)</span><br></pre></td></tr></table></figure>

<p>第三行的 <code>(100)</code> 表示定义完直接调用  100 即为参数 </p>
<p><strong>匿名函数赋值给变量</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f:&#x3D;fun (data int) &#123;</span><br><span class="line">    fmt.Println(&quot;hello&quot;, data)</span><br><span class="line">&#125;</span><br><span class="line">f(100)</span><br></pre></td></tr></table></figure>

<p><strong>匿名函数作为回调函数</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">func get_value(list []int, f func(int))&#123;</span><br><span class="line">    for _, v :&#x3D; range list &#123;</span><br><span class="line">        f(v)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main()&#123;</span><br><span class="line"></span><br><span class="line">    get_value([]int&#123;1,2,3&#125;,func (v int)&#123;fmt.Println(v)&#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<h1 id="自定义类型方法"><a href="#自定义类型方法" class="headerlink" title="自定义类型方法"></a>自定义类型方法</h1><blockquote>
<p>与函数格式很类似，只是func name 前有 接受者</p>
</blockquote>
<p>##值方法与指针方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">type test struct&#123;</span><br><span class="line">    name string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (t test) TestValue() &#123;</span><br><span class="line">    fmt.Printf(&quot;%s\n&quot;,t.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (t *test) TestPointer() &#123;</span><br><span class="line">    fmt.Printf(&quot;%s\n&quot;,t.name)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func main()&#123;</span><br><span class="line">    t :&#x3D; test&#123;&quot;wang&quot;&#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;&#x2F;这里发生了复制,不受后面修改的影响</span><br><span class="line">    m :&#x3D; t.TestValue</span><br><span class="line">    </span><br><span class="line">    t.name &#x3D; &quot;Li&quot;</span><br><span class="line">    m1 :&#x3D; (*test).TestPointer</span><br><span class="line">    &#x2F;&#x2F;Li</span><br><span class="line">    m1(&amp;t)    </span><br><span class="line">    </span><br><span class="line">    &#x2F;&#x2F;wang</span><br><span class="line">    m()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p>#tips </p>
<h2 id="字符串更改"><a href="#字符串更改" class="headerlink" title="字符串更改"></a>字符串更改</h2><blockquote>
<p>go string 默认不可修改，需要先转为tune 数组然后再转回字符串</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s :&#x3D; &quot;hello&quot;c :&#x3D; []rune(s)c[0] &#x3D; &#39;c&#39;s2 :&#x3D; string(c) fmt.Printf(&quot;%s\n&quot;, s2)</span><br></pre></td></tr></table></figure>



<p>#tips</p>
<h2 id="打印变量类型"><a href="#打印变量类型" class="headerlink" title="打印变量类型"></a>打印变量类型</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fmt.Println(reflect.TypeOf(a))</span><br><span class="line"></span><br><span class="line">或者</span><br><span class="line">fmt.Printf(&quot;%T&quot;, a)</span><br></pre></td></tr></table></figure>

<p>#time.Sleep（默认单位纳秒）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;sleep 2s </span><br><span class="line">time.Sleep(time.Duration(2)*time.Second)</span><br></pre></td></tr></table></figure>

<h2 id="json解析"><a href="#json解析" class="headerlink" title="json解析"></a>json解析</h2><p>import “encoding/json”</p>
<p>body:=”{“status”:0,”info”:”该流程已经完结，不需要重复审批过啦”}”<br>//定义map<br>var dat map[string]interface{}<br>json.Unmarshal(body, &amp;dat)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/03/30/Django%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/03/30/Django%E7%99%BB%E5%BD%95%E9%AA%8C%E8%AF%81/" class="post-title-link" itemprop="url">Django登录验证</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-30 15:07:48" itemprop="dateCreated datePublished" datetime="2018-03-30T15:07:48+08:00">2018-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/develop/" itemprop="url" rel="index"><span itemprop="name">develop</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>之前开发的一套后台报表系统，现在页面越来越多，又搞了个内网域名，有的时候会被安全部的检查攻击，所以必须搞一个登录验证的功能。说起来也好写。因为毕竟Django有整套的解决方案。</p>
</blockquote>
<ul>
<li>使用的是Django的（authentication）认证框架。</li>
<li>没有写注册功能（因为根本不需要）</li>
<li>没有写登出（好像也不需要）</li>
</ul>
<p>Django拥有一个内置的认证（authentication）框架用来操作用户认证（authentication），会话（sessions），权限（permissions）以及用户组。这个认证（authentication）系统包含了一些普通用户的操作视图（views），例如：登录，登出，修改密码以及重置密码。</p>
<p>（authentication）框架位于django.contrib.auth，被其他Django的contrib包调用。所以我们只需要学会怎么使用。</p>
<p>这个认证（authentication）系统还包含了以下模型（models）：</p>
<ul>
<li>User：一个包含了基础字段的用户模型（model）；这个模型（model）的主要字段有：username， password, email, first_name, last_name, is_active。</li>
<li>Group：一个组模型（model）用来分类用户</li>
<li>Permission：执行特定操作的标识<br>这个框架还包含默认的认证（authentication）视图（views）和表单（forms），我们之后会用到。<br>所以之后的工作可能还会涉及到权限认证，也要使用这个框架（到时候再说，反正都是我一个人搞🙄🙄）</li>
</ul>
<h2 id="开始accounts应用"><a href="#开始accounts应用" class="headerlink" title="开始accounts应用"></a>开始accounts应用</h2><p>新建一个应用取名<code>accounts</code>,（注意因为用到Django的登录框架所以取名稍微规范一点）</p>
<pre><code>django-admin startapp accounts</code></pre><p>在工程目录<code>settings.py</code> 的<code>INSTALLED_APPS</code> 中添加<code>accounts</code>APP </p>
<pre><code>INSTALLED_APPS = (
    &apos;account&apos;,
    # ...
)</code></pre><p>执行migrate同步应用models到数据库。</p>
<pre><code>python manage.py migrate</code></pre><h2 id="Forms表单"><a href="#Forms表单" class="headerlink" title="Forms表单"></a>Forms表单</h2><p>在<code>accounts</code>下面新建一个<code>forms.py</code>, 写入以下内容</p>
<pre><code>#-*- coding: UTF-8 -*-
from django import forms

class LoginForm(forms.Form):
    username = forms.CharField(label=&quot;用户名&quot;,
                    max_length=&quot;20&quot;)
    password = forms.CharField(label=&quot;密码&quot;, 
                    max_length=&quot;20&quot;,widget=forms.PasswordInput)</code></pre><p>请注意我们使用PasswordInput控件来渲染HTML的<code>Input</code>元素。它包含<code>type=&quot;password&quot;</code>属性，不用再定义。</p>
<h2 id="views视图"><a href="#views视图" class="headerlink" title="views视图"></a>views视图</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">from django.http import HttpResponse</span><br><span class="line">from django.shortcuts import render</span><br><span class="line">from django.contrib.auth import authenticate, login</span><br><span class="line">from .forms import LoginForm</span><br><span class="line">from django.contrib.auth.decorators import login_required</span><br><span class="line">from django.http import HttpResponseRedirect</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def user_login(request):</span><br><span class="line">    if request.method &#x3D;&#x3D; &#39;POST&#39;:</span><br><span class="line">        form &#x3D; LoginForm(request.POST)</span><br><span class="line">        if form.is_valid():</span><br><span class="line">            cd &#x3D; form.cleaned_data</span><br><span class="line">            user &#x3D; authenticate(username&#x3D;cd[&#39;username&#39;],</span><br><span class="line">                                password&#x3D;cd[&#39;password&#39;])</span><br><span class="line">            if user is not None:</span><br><span class="line">                if user.is_active:</span><br><span class="line">                    login(request, user)</span><br><span class="line">                    #return HttpResponse(&#39;Authenticated successfully&#39;)</span><br><span class="line">                    return HttpResponseRedirect(&#39;&#x2F;accounts&#x2F;dashboard&#39;)</span><br><span class="line">                else:</span><br><span class="line">                    return HttpResponse(&#39;Disabled accounts&#39;)</span><br><span class="line">            else:</span><br><span class="line">                return HttpResponse(&#39;Invalid login&#39;)</span><br><span class="line">    else:</span><br><span class="line">        form &#x3D; LoginForm()</span><br><span class="line">    return render(request, &#39;accounts&#x2F;login.html&#39;, &#123;&#39;form&#39;: form&#125;)</span><br><span class="line">    </span><br><span class="line">@login_required</span><br><span class="line">def dashboard(request):</span><br><span class="line">    pass</span><br><span class="line">    return render(request,</span><br><span class="line">              &#39;accounts&#x2F;dashboard.html&#39;,</span><br><span class="line">              &#123;&#39;section&#39;: &#39;dashboard&#39;&#125;)</span><br></pre></td></tr></table></figure>

<p>解读一下以上内容。<br>login_in函数：<br>当一个<code>GET</code>请求调用user_login函数的时候。会直接实例化一个登录表单呈现给用户。<br>当用户<code>POST</code>提交这个表单的时候：</p>
<ol>
<li>通过使用<code>form=LoginForm（request.POST）</code>使用用户提交的数据实例化form</li>
<li>检查form是否有效</li>
<li>使用<code>authenticate()</code>方法，通过数据库对这个用户进行验证，验证通过，通过<code>login()</code>方法集合用户到session中,并重定向到一个初始页面，没有通过，返回<code>Invalid login</code></li>
</ol>
<p>dashboard函数之后会提到。</p>
<h2 id="accounts的urls-py"><a href="#accounts的urls-py" class="headerlink" title="accounts的urls.py"></a>accounts的urls.py</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">from django.conf.urls import url</span><br><span class="line">from . import views</span><br><span class="line"></span><br><span class="line">urlpatterns &#x3D; [</span><br><span class="line">    # post views</span><br><span class="line">    url(r&#39;^dashboard$&#39;, views.dashboard, name&#x3D;&#39;dashboard&#39;),</span><br><span class="line">    url(r&#39;^login&#x2F;$&#39;, views.user_login, name&#x3D;&#39;login&#39;),</span><br><span class="line"></span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p>注册了两个url /login为登录页，dashboard为初始页。</p>
<h2 id="settings文件"><a href="#settings文件" class="headerlink" title="settings文件"></a>settings文件</h2><p>添加了两行，</p>
<ul>
<li>LOGIN_REDIRECT_URL：告诉Django用户登录成功后如果contrib.auth.views.login视图（view）没有获取到next参数将会默认重定向到哪个URL。</li>
<li>LOGIN_URL：重定向用户登录的URL（例如：使用login_required装饰器（decorator））。</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LOGIN_REDIRECT_URL &#x3D; &#39;&#x2F;accounts&#x2F;dashboard&#39;</span><br><span class="line">LOGIN_URL &#x3D; reverse_lazy(&#39;login&#39;)</span><br></pre></td></tr></table></figure>

<h2 id="前端页面"><a href="#前端页面" class="headerlink" title="前端页面"></a>前端页面</h2><p>accounts-base.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">&#123;% load staticfiles %&#125;</span><br><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">    &lt;head&gt;</span><br><span class="line"></span><br><span class="line">        &lt;meta charset&#x3D;&quot;UTF-8&quot;&gt;</span><br><span class="line">        &lt;title&gt;&#123;% block title %&#125;&#123;% endblock %&#125;&lt;&#x2F;title&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;&#x2F;static&#x2F;bootstrap-table-master&#x2F;docs&#x2F;assets&#x2F;js&#x2F;jquery.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">        &lt;script src&#x3D;&quot;&#x2F;static&#x2F;bootstrap-3.3.7&#x2F;docs&#x2F;dist&#x2F;js&#x2F;bootstrap.min.js&quot;&gt;&lt;&#x2F;script&gt;</span><br><span class="line">        &lt;link href&#x3D;&quot;&#123;% static &quot;&#x2F;static&#x2F;css&#x2F;base.css&quot; %&#125;&quot; rel&#x3D;&quot;stylesheet&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;&#x2F;head&gt;</span><br><span class="line"></span><br><span class="line">    &lt;body&gt;</span><br><span class="line">        &lt;div id&#x3D;&quot;header&quot;&gt;</span><br><span class="line">          &lt;h1 class&#x3D;&quot;page-header&quot;&gt;&lt;span class&#x3D;&quot;glyphicon glyphicon-user&quot;&gt;&lt;&#x2F;span&gt; 用户登录&lt;&#x2F;h1&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;div id&#x3D;&quot;content&quot;&gt;</span><br><span class="line">            &#123;% block content %&#125;</span><br><span class="line">            &#123;% endblock %&#125;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p>accounts/login.html</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &quot;account-base.html&quot; %&#125;</span><br><span class="line">&#123;% block title %&#125;Log-in&#123;% endblock %&#125;</span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">    &lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line"></span><br><span class="line">    &lt;form class&#x3D;&quot;form-line&quot; action&#x3D;&quot;.&quot; method&#x3D;&quot;post&quot;&gt;</span><br><span class="line">        &#123;&#123; form.as_p &#125;&#125;</span><br><span class="line">        &#123;% csrf_token %&#125;</span><br><span class="line">        &lt;div  class&#x3D;&quot;form-group&quot;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;col-md-5&quot;&gt;</span><br><span class="line">                &lt;input type&#x3D;&quot;submit&quot; class&#x3D;&quot;btn btn-primary btn-block&quot; value&#x3D;&quot;登录&quot; widget&#x3D;&quot;40&quot;&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;form&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>base.css<br>忽略了。。自己可以找些好看的样式。</p>
<h2 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h2><p>我们把之前相关的页面函数都加个<code>login_required装饰器</code>就可以了。如果没有登录直接访问这个页面就会重定向到登录页面。完美。</p>
<p>上一张登录页图片，哈哈<br> <img src="http://or2jd66dq.bkt.clouddn.com/15223978300797.jpg" alt=""></p>
<p>参考：<br><a href="https://www.jianshu.com/p/6aab901fefd3">form表单设置标签样式</a><br><a href="https://www.jianshu.com/p/05810d38f93a">Django By Example翻译</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/03/20/tcpdump-wireshark%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/03/20/tcpdump-wireshark%E6%8A%93%E5%8C%85%E5%88%86%E6%9E%90/" class="post-title-link" itemprop="url">tcpdump+wireshark抓包分析</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-03-20 11:04:57" itemprop="dateCreated datePublished" datetime="2018-03-20T11:04:57+08:00">2018-03-20</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><strong>某天</strong>，梳理kafka每个Topic流量，其中有个Topic有流量，但是业务负责人不知道从哪台机器生产的消息。我们知道server端<code>IP</code>+<code>端口</code>,<code>Topic名字</code>也知道,现在需要查找<code>生产IP</code>.此为背景。</p>
<p>首先，在kafka的server端使用tcp抓包，并记录存到文件中。然后scp到本地使用wireshark分析。‘</p>
<h1 id="TCP-知识点"><a href="#TCP-知识点" class="headerlink" title="TCP 知识点"></a>TCP 知识点</h1><p>一个TCP连接需要四个元组来表示是同一个连接（src_ip, src_port, dst_ip, dst_port）准确说是五元组，还有一个是协议。但因为这里只是说TCP协议，所以，这里我只说四元组。</p>
<p>tcp头格式<br><img src="/media/15649984945889.jpg" alt=""></p>
<p>Seq (S ,Sequence Number是包的序号,用于解决包乱序的问题)</p>
<p><strong>标志位</strong> （tcp flag）</p>
<ul>
<li>C Reduced</li>
<li>E ECN Echo </li>
<li>S (Syn Synchronize Sequence Numbers 用于同步seq序列号)</li>
<li>A (ACK Acknowledgement Number就是ACK——用于确认收到，用于解决不丢包的问题)</li>
<li>R (Reset)</li>
<li>P (Push)</li>
<li>F (Fin )</li>
</ul>
<h2 id="三次握手，四次挥手"><a href="#三次握手，四次挥手" class="headerlink" title="三次握手，四次挥手"></a>三次握手，四次挥手</h2><p><img src="/media/15649992942037.jpg" alt=""></p>
<ul>
<li><p>对于建链接的3次握手，主要是要初始化Sequence Number 的初始值。通信的双方要互相通知对方自己的初始化的Sequence Number（缩写为ISN：Inital Sequence Number）——所以叫SYN，全称Synchronize Sequence Numbers。也就上图中的 x 和 y。这个号要作为以后的数据通信的序号，以保证应用层接收到的数据不会因为网络上的传输的问题而乱序（TCP会用这个序号来拼接数据）。</p>
</li>
<li><p>对于4次挥手，其实你仔细看是2次，因为TCP是全双工的，所以，发送方和接收方都需要Fin和Ack。只不过，有一方是被动的，所以看上去就成了所谓的4次挥手。如果两边同时断连接，那就会就进入到CLOSING状态，然后到达TIME_WAIT状态。</p>
</li>
</ul>
<p>下图两边同时断开连接<br><img src="/media/15649993722526.jpg" alt=""></p>
<h2 id="Tcpdump抓包过程"><a href="#Tcpdump抓包过程" class="headerlink" title="Tcpdump抓包过程"></a>Tcpdump抓包过程</h2><p>tcpdump -i eth0 -w - src host 10.138.83.150 and  dst port 2181  | strings</p>
<p>tcpdump -i eth0 -c 1000000 -nn port 9092 -w 9092.pcap</p>
<p>tcpdump -i eth2  -c 10000 -w 9092.pcap  host 10.175.223.29 and port 9092</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/01/16/bootstrap-bootstrap-table%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/01/16/bootstrap-bootstrap-table%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">bootstrap-bootstrap-table笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-01-16 16:33:11" itemprop="dateCreated datePublished" datetime="2018-01-16T16:33:11+08:00">2018-01-16</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E5%89%8D%E7%AB%AF/" itemprop="url" rel="index"><span itemprop="name">前端</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>之前组内是有一款manager工具的，用来展示一下报表或者报警状态，使用到的技术栈是<code>Django</code>+<code>EasyUI</code>,但是EasyUI的界面UI真的是很easy,简直easy到是上世纪的既视感。有的大神可能会说你可以改下EasyUI的样式表啊。在我看来一个运维搞这个可能成本有点高，最关键是搞出来有可能不好看，有非常大的可能。。。</p>
<p>最关键是我们之前那个manager的Django代码没有用到ORM使用起来总感觉不是特别方便。冗余代码有点多。种种原因，我组决定新搞一套与之前那个独立出来，感谢领导对我任性的容忍，以及能力的信任。。</p>
<p>我的前端结构是bootstrap+bootatrap-table 来代替EasyUI。这个过程也是有点曲折，一直摸索着前进。因为之前不懂前端代码（但是HTML，CSS还是懂一点），而且我不想写的太low，影响名声。所以前期经常是写出来之后发现更好的方法，然后推倒重来。。。也用到很多demo。反正这次开发是后端精力占了10%-20%,前端占到其余。</p>
<p>以下是用到的前端技术，及其官方文档记录。</p>
<ul>
<li>bootstrap: <a href="https://bootsnipp.com">demo</a>，Twitter开源的前端框架，非常好用，也非常火，衍生出很多有些的框架</li>
<li>bootstrap-table: <a href="http://bootstrap-table.wenzhixin.net.cn/zh-cn/documentation/#%E8%A1%A8%E6%A0%BC%E5%8F%82%E6%95%B0">文档</a>，是一个基于bootstrap样式的表格框架。由国人自己（@wenzhixin）开发，相比于使用人数很多的jQuery-EasyUI，界面更现代一点，排版更好看一点，已封装好的功能不如EasyUI丰富，但基本功能都具备。</li>
<li>datetimepicker: <a href="https://eonasdan.github.io/bootstrap-datetimepicker/">时间选择器</a>，一个时间选择器。</li>
<li>bootstrap-select: <a href="https://silviomoreto.github.io/bootstrap-select/examples/">demo</a></li>
</ul>
<h2 id="bootstrap"><a href="#bootstrap" class="headerlink" title="bootstrap"></a>bootstrap</h2><p>整个base.html 用到的是bootstrap的一个demo，自己稍作修改。没有遇到困难。<br>关于bootstrap的栅格系统，有兴趣可以看下。</p>
<h2 id="bootstrap-table"><a href="#bootstrap-table" class="headerlink" title="bootstrap-table"></a>bootstrap-table</h2><p><code>bootstrap-table</code>就是这次项目最核心的技术了。它很类似<code>EasyUI</code>，整体的样式是基于<code>bootstrap</code>的,所以两个东西一起用界面非常友好。但是bug还是有一点。很多功能用法很像，但是又有些不同，毕竟EasyUI久经考验，我先是把它的<code>examples</code>全部看了一遍。了解了基本的用法功能。然后对应自己的场景套用。下面根据几个需求说一下我的解决办法。</p>
<h3 id="数据传入"><a href="#数据传入" class="headerlink" title="数据传入"></a>数据传入</h3><p>数据传入到<code>bootstrap-table</code>有从前端角度来讲，两种方式</p>
<ol>
<li>后端直接将<code>data</code>数据渲染<code>{data: data_list}</code>到页面，然后通过JS <img src="http://or2jd66dq.bkt.clouddn.com/15166031572156.jpg" alt=""><br>的方法赋予到变量。注意数据格式是<code>[{id: 1, name: &quot;jordan&quot;}, [id: 2, name: &quot;kobe&quot;]</code> 这样一个列表的形式，然后在<code>bootstrap-table</code>中指定<code>date: $row_list</code>即可。<br><img src="http://or2jd66dq.bkt.clouddn.com/15165911659820.jpg" alt=""></li>
</ol>
<ol start="2">
<li>直接在<code>bootstrap-table</code>中指定<code>url</code>,<code>method</code>,<code>queryParams</code>,<code>ajaxOptions</code> 通过调用<code>ajax</code>直接获取数据。<br><img src="http://or2jd66dq.bkt.clouddn.com/15165923280106.jpg" alt=""></li>
</ol>
<h3 id="父子表格实现"><a href="#父子表格实现" class="headerlink" title="父子表格实现"></a>父子表格实现</h3><p><a href="http://issues.wenzhixin.net.cn/bootstrap-table/#options/detail-view.html">Detail View</a><br><a href="http://issues.wenzhixin.net.cn/bootstrap-table/#options/sub-table.html">onExpandRow </a></p>
<p>官方给的实例叫<code>Detail View</code>是➕点击动作，<code>onExpandRow</code>是点击➕出发的函数。<br>我希望用<code>onExpandRow</code>来调用一次ajax，返回后台数据。<br>注意：<br><code>onExpandRow</code>后面跟的函数必须带有 (index, row, $detail) 这三个参数。<br><code>queryParams</code> 和 <code>ajaxOptions</code> 是url请求的参数。可以不写，可以为空根据实际情况。<br>代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">&lt;script&gt;</span><br><span class="line"></span><br><span class="line">    var $table&#x3D;$(&#39;#table&#39;);</span><br><span class="line"></span><br><span class="line">        $table.bootstrapTable(&#123;</span><br><span class="line">            detailView: true,</span><br><span class="line">            columns: [&#123;</span><br><span class="line">                title: &quot;Topic&quot;,</span><br><span class="line">                field: &quot;topic&quot;,</span><br><span class="line">                sortable: &quot;true&quot;</span><br><span class="line"></span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                title: &quot;集群名&quot;,</span><br><span class="line">                field: &quot;cluster&quot;,</span><br><span class="line">                sortable: &quot;true&quot;</span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                title: &quot;状态&quot;,</span><br><span class="line">                field: &quot;topic_state&quot;,</span><br><span class="line">                sortable: &quot;true&quot;,</span><br><span class="line">                align: &quot;center&quot;,</span><br><span class="line">                searchable: &quot;true&quot;</span><br><span class="line">            &#125;,&#123;</span><br><span class="line">                title: &quot;日志地址&quot;,</span><br><span class="line">                field: &quot;log_path&quot;,</span><br><span class="line"></span><br><span class="line">            &#125;,],</span><br><span class="line">            data: $rows,</span><br><span class="line">            onExpandRow: function (index, row, $detail) &#123;</span><br><span class="line">                InitSubTable(index, row, $detail);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    function InitSubTable(index, row, $detail) &#123;</span><br><span class="line">        var row_cluster&#x3D;row.cluster,</span><br><span class="line">            row_topic&#x3D;row.topic;</span><br><span class="line"></span><br><span class="line">        var rowsdate&#x3D;$(&quot;#datetimepicker1&quot;).find(&quot;input&quot;).val();</span><br><span class="line">        var cur_table &#x3D; $detail.html(&#39;&lt;table&gt;&lt;&#x2F;table&gt;&#39;).find(&#39;table&#39;);</span><br><span class="line"></span><br><span class="line">        $(cur_table).bootstrapTable(&#123;</span><br><span class="line">            url: &#39;&#x2F;url_detail&#39;,</span><br><span class="line">            method: &#39;get&#39;,</span><br><span class="line">            queryParams: &#123;cluster: row_cluster, topic: row_topic, date: rowsdate&#125;,</span><br><span class="line">            ajaxOptions: &#123;cluster: row_cluster, topic: row_topic, date: rowsdate&#125;,</span><br><span class="line">            columns: [&#123;</span><br><span class="line">                field: &quot;state&quot;,</span><br><span class="line">                title: &quot;状态&quot;,</span><br><span class="line">                sortable: &quot;true&quot;</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                field: &quot;hostname&quot;,</span><br><span class="line">                title: &quot;机器名&quot;,</span><br><span class="line">                sortable: &quot;true&quot;</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                field: &quot;date&quot;,</span><br><span class="line">                title: &quot;日期&quot;</span><br><span class="line">           &#125;]</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">    &#125;;</span><br></pre></td></tr></table></figure>

<p>效果<br><img src="http://or2jd66dq.bkt.clouddn.com/15165934361985.jpg" alt=""></p>
<h3 id="字段Formatter以及cellStyle"><a href="#字段Formatter以及cellStyle" class="headerlink" title="字段Formatter以及cellStyle"></a>字段Formatter以及cellStyle</h3><p>定义函数<br>函数中三个参数也是必须的</p>
<ol>
<li>状态标签格式化</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">function statusFormatter(value, row, index) &#123;</span><br><span class="line">   if (value &#x3D;&#x3D;&#x3D; 1) &#123;</span><br><span class="line">     return &#39;&lt;span class&#x3D;&quot;label label-success&quot;&gt;正常&lt;&#x2F;span&gt;&#39;;</span><br><span class="line">   &#125; else if (value &#x3D;&#x3D;&#x3D; 0) &#123;</span><br><span class="line">     return &#39;&lt;span class&#x3D;&quot;label label-danger&quot;&gt;异常&lt;&#x2F;span&gt;&#39;;</span><br><span class="line">   &#125; else if (value &#x3D;&#x3D;&#x3D; 2) &#123;</span><br><span class="line">       return &#39;&lt;span class&#x3D;&quot;label label-default&quot;&gt;不存在&lt;&#x2F;span&gt;&#39;;</span><br><span class="line">   &#125; else if (value &#x3D;&#x3D;&#x3D; 3) &#123;</span><br><span class="line">       return &#39;&lt;span class&#x3D;&quot;label label-info&quot;&gt;Miss&lt;&#x2F;span&gt;&#39;;</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p><code>bootstrap-table</code>使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$(cur_table).bootstrapTable(&#123;</span><br><span class="line">            ...</span><br><span class="line">            columns: [&#123;</span><br><span class="line">                field: &quot;state&quot;,</span><br><span class="line">                title: &quot;状态&quot;,</span><br><span class="line">                sortable: &quot;true&quot;,</span><br><span class="line">                formatter: &quot;statusFormatter&quot;</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                field: &quot;hostname&quot;,</span><br><span class="line">                title: &quot;机器名&quot;,</span><br><span class="line">                sortable: &quot;true&quot;</span><br><span class="line">            &#125;, &#123;</span><br><span class="line">                field: &quot;date&quot;,</span><br><span class="line">                title: &quot;日期&quot;</span><br><span class="line">           &#125;]</span><br><span class="line">           ...</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>
<p>效果：<br><img src="http://or2jd66dq.bkt.clouddn.com/15165939077872.jpg" alt=""></p>
<ol start="2">
<li>表格底色<code>cellSytle</code>格式化。</li>
</ol>
<p>函数代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">function cellStyle(value, row, index) &#123;</span><br><span class="line">    var classes &#x3D; [&#39;active&#39;, &#39;success&#39;, &#39;info&#39;, &#39;warning&#39;, &#39;danger&#39;];</span><br><span class="line">    if (value &gt; 1024*1024*1024*1024) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            &quot;classes&quot;: classes[4]</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; else if ( 1024*1024*1024 &lt; value &amp;&amp; value &lt; 1024*1024*1024*1024) &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            &quot;classes&quot;: classes[3]</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        return &#123;</span><br><span class="line">            &quot;classes&quot;: classes[1]</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>bootstrap-table 中引用类似formatter </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cellStyle: &quot;cellStyle&quot;</span><br></pre></td></tr></table></figure>


<ol start="3">
<li>流量数值格式化</li>
</ol>
<blockquote>
<p>因为数据流量值参差不齐，有的日流量几T，有的只有几M，所以不能是制定统一的单位。</p>
</blockquote>
<p>函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">function formatSize(value,row,index,idx &#x3D; 0 ) &#123;</span><br><span class="line"></span><br><span class="line">    Number(value);</span><br><span class="line">    const units &#x3D; [&quot;B&quot;, &quot;KB&quot;, &quot;MB&quot;, &quot;GB&quot;, &quot;TB&quot;];</span><br><span class="line">    if (value &lt; 1024 || idx &#x3D;&#x3D;&#x3D; units.length - 1) &#123;</span><br><span class="line">        return value.toFixed(1) + units[idx];</span><br><span class="line">    &#125;</span><br><span class="line">    return formatSize(value &#x2F; 1024, row, index, ++idx);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>bootstrap使用formatter引用。</p>
<p>2，3效果：如下图</p>
<p><img src="http://or2jd66dq.bkt.clouddn.com/15166009956222.jpg" alt=""></p>
<h3 id="bootstrap-table-refresh"><a href="#bootstrap-table-refresh" class="headerlink" title="bootstrap-table refresh"></a>bootstrap-table refresh</h3><p>如果不是父子表，而表头自己加了一些筛选条件的话，每次筛选条件改变，我们需要用refresh刷新表内的数据<br>最好写个判断，需要注意的是 <code>refresh</code> 的参数并不是第一次调用ajax的时候的<code>queryParams</code> 而是变成了<code>query</code>。。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">function init() &#123;</span><br><span class="line">    &#x2F;&#x2F; 获取&lt;input&gt;host</span><br><span class="line">    var host&#x3D;$(&quot;#hostname&quot;).val();</span><br><span class="line">    var $table &#x3D; $(&#39;#table1&#39;);</span><br><span class="line">    &#x2F;&#x2F; 判断如果表格存在，刷新表格</span><br><span class="line">    if($table.length) &#123;</span><br><span class="line">        console.log(&#39;refresh&#39;, host)</span><br><span class="line">        $table.bootstrapTable(&#39;refresh&#39;, &#123;</span><br><span class="line">            url: &#39;&#x2F;search_detail&#39;,</span><br><span class="line">            method: &#39;get&#39;,</span><br><span class="line">            query: &#123;hostname: host&#125;,</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        &#x2F;&#x2F; 构建table，放到&lt;div id&#x3D;&quot;mydiv&quot;&gt; 中</span><br><span class="line">        var mydiv &#x3D; document.getElementById(&quot;mydiv&quot;);</span><br><span class="line">        var tb &#x3D; document.createElement(&quot;table&quot;);</span><br><span class="line">        tb.id &#x3D; &quot;table1&quot;;</span><br><span class="line">        mydiv.append(tb)</span><br><span class="line"></span><br><span class="line">        $table &#x3D; $(&#39;#table1&#39;);</span><br><span class="line">        $table.bootstrapTable(&#123;</span><br><span class="line">            url: &#39;&#x2F;search_detail&#39;,</span><br><span class="line">            method: &#39;get&#39;,</span><br><span class="line">            queryParams: &#123;hostname: host&#125;,</span><br><span class="line">            ajaxOptions: &#123;hostname: host&#125;,</span><br><span class="line">            striped: true,</span><br><span class="line">            pagination: true,</span><br><span class="line">            pageSize: 10,</span><br><span class="line">            pageList: [10, 25, 50, 100],</span><br><span class="line">            search: true,</span><br><span class="line">            ...</span><br><span class="line">            ...</span><br></pre></td></tr></table></figure>

<h2 id="bootstrap-timepicker-使用"><a href="#bootstrap-timepicker-使用" class="headerlink" title="bootstrap timepicker 使用"></a>bootstrap timepicker 使用</h2><blockquote>
<p>一个时间选择插件，我们可以直接使用它来选择日期，然后用jQuery获取选择的数据，调用ajax的时候添加到参数之中。需要引入相关js,css,我这里省略了。具体官网介绍。</p>
</blockquote>
<p>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;col-sm-3&quot; style&#x3D;&quot;height:20px;&quot;&gt;</span><br><span class="line"></span><br><span class="line">        &lt;div class&#x3D;&#39;input-group date&#39; id&#x3D;&#39;datetimepicker1&#39;&gt;</span><br><span class="line">            &lt;input type&#x3D;&#39;text&#39; class&#x3D;&quot;form-control&quot; &gt;</span><br><span class="line">            &lt;span class&#x3D;&quot;input-group-addon&quot;&gt;</span><br><span class="line">                &lt;span class&#x3D;&quot;glyphicon glyphicon-calendar&quot;&gt;&lt;&#x2F;span&gt;</span><br><span class="line">            &lt;&#x2F;span&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">    $(function () &#123;</span><br><span class="line">        $(&#39;#datetimepicker1&#39;).datetimepicker(&#123;</span><br><span class="line">            viewMode: &#39;days&#39;,</span><br><span class="line">            format: &#39;YYYY-MM-DD&#39;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure>
<p>然后jQuery用以下代码获取选择值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 根据div-id来寻找其中input 标签的选择值</span><br><span class="line">var rowsdate&#x3D;$(&quot;#datetimepicker1&quot;).find(&quot;input&quot;).val();</span><br></pre></td></tr></table></figure>
<p>显示如图。<br><img src="http://or2jd66dq.bkt.clouddn.com/15165999679602.jpg" alt=""></p>
<h2 id="bootstrap-select-input-button-输入框组"><a href="#bootstrap-select-input-button-输入框组" class="headerlink" title="bootstrap select input button 输入框组"></a>bootstrap select input button 输入框组</h2><blockquote>
<p>顾名思义输入框组就是把两个或者几个输入框组合一下。其实上面datetimepicker 就是一个输入框组。但是那个demo是官方给的，而且在父子表中使用不用提交按钮，因为那个➕就代替了提交按钮。如果不是父子表我们需要在输入框后面加一个button。为了美观我选择把它们两个放到一块儿。</p>
</blockquote>
<p>使用到了栅格系统.注意其中几个div 之中class的作用<br>代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;div class&#x3D;&quot;container&quot;&gt;</span><br><span class="line">&lt;div class&#x3D;&quot;row&quot;&gt;</span><br><span class="line">    &lt;div class&#x3D;&#39;col-sm-3&#39;&gt;</span><br><span class="line">        &lt;div class&#x3D;&quot;input-group date pull-right&quot; id&#x3D;&quot;mydiv&quot;&gt;</span><br><span class="line">            &lt;input type&#x3D;&#39;text&#39; class&#x3D;&quot;form-control&quot; id&#x3D;&#39;datetimepicker4&#39; &#x2F;&gt;</span><br><span class="line">            &lt;div class&#x3D;&quot;input-group-btn&quot;&gt;</span><br><span class="line">                        &lt;span class&#x3D;&quot;input-group-btn&quot;&gt;</span><br><span class="line">                            &lt;button onclick&#x3D;&quot;init()&quot; class&#x3D;&quot;btn btn-default&quot; type&#x3D;&quot;button&quot;&gt;日期&lt;&#x2F;button&gt;</span><br><span class="line">                        &lt;&#x2F;span&gt;</span><br><span class="line">            &lt;&#x2F;div&gt;</span><br><span class="line">        &lt;&#x2F;div&gt;</span><br><span class="line">    &lt;&#x2F;div&gt;</span><br><span class="line"></span><br><span class="line">    &lt;script type&#x3D;&quot;text&#x2F;javascript&quot;&gt;</span><br><span class="line">        $(function () &#123;</span><br><span class="line">            $(&#39;#datetimepicker4&#39;).datetimepicker(&#123;</span><br><span class="line">                viewMode: &#39;days&#39;,</span><br><span class="line">                format: &#39;YYYY-MM-DD&#39;</span><br><span class="line">            &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125;);</span><br><span class="line">    &lt;&#x2F;script&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br><span class="line">&lt;&#x2F;div&gt;</span><br></pre></td></tr></table></figure>

<p>效果：<br>点击 白框 日期选择器会弹出来，后面的<code>日期</code>按钮即为提交按钮，点击触发刷新函数。<br><img src="http://or2jd66dq.bkt.clouddn.com/15166014970679.jpg" alt=""></p>
<p>同理，下图也可以<br><img src="http://or2jd66dq.bkt.clouddn.com/15166118776986.jpg" alt=""></p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我只记录了自己花费时间解决的问题，其他可以直接在官方文档中看到的，比如sortable,分页，表内搜索啥的，这篇笔记就略过了，建议如果有根据我这篇文章动手做的同学先把<code>bootstrap-table</code>例子都大概看一遍。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/12/19/python%E9%98%B2%E6%AD%A2SQL%E6%B3%A8%E5%85%A5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/12/19/python%E9%98%B2%E6%AD%A2SQL%E6%B3%A8%E5%85%A5/" class="post-title-link" itemprop="url">python防止SQL注入</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-19 10:50:46" itemprop="dateCreated datePublished" datetime="2017-12-19T10:50:46+08:00">2017-12-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>之前我写python脚本连接MySQL的时候会这样写（MySQLdb库）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">def conn_mysql():</span><br><span class="line">    port &#x3D; 3306</span><br><span class="line">    host &#x3D; &quot;10.0.0.1&quot;</span><br><span class="line">    user &#x3D; &quot;fqq&quot;</span><br><span class="line">    pass &#x3D; &quot;pass&quot;</span><br><span class="line">    dbname &#x3D; &quot;test&quot;</span><br><span class="line">    timeout &#x3D; 30 * 60</span><br><span class="line">    conn &#x3D; MySQLdb.connect(host&#x3D;host, user&#x3D;user, passwd&#x3D;pass,</span><br><span class="line">                           port&#x3D;port, db&#x3D;dbname, connect_timeout&#x3D;timeout,                                   </span><br><span class="line">                           charset&#x3D;&quot;utf8&quot;)</span><br><span class="line">    return conn</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def mysql_execute(conn, sql):</span><br><span class="line">    cur &#x3D; conn.cursor()</span><br><span class="line">    try:</span><br><span class="line">        cur.execute(sql)</span><br><span class="line">        conn.commit()</span><br><span class="line">    except:</span><br><span class="line">        conn.rollback()</span><br><span class="line">    if cur:</span><br><span class="line">        cur.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def close(conn):</span><br><span class="line">    if conn:</span><br><span class="line">        conn.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def insert_mysql(sql):</span><br><span class="line">    conn &#x3D; conn_mysql()</span><br><span class="line">    mysql_execute(conn, sql)</span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<p>一直秉持了很久。但是最近发现还是有问题的。这样会有一些安全问题。如果在工程代码里是大忌。原谅我没有写过工程，对不起。</p>
<p>那么，这样写到底问题出在哪里了？<br>需要看这个<a href="http://www.cnblogs.com/hkncd/archive/2012/03/31/2426274.html">blog</a></p>
<p>这代码里无疑是使用<code>execute</code>方法去处理的SQL请求。</p>
<p>然而<code>excute</code>正确的使用方法应该是</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Help on method execute in module MySQLdb.cursors:</span><br><span class="line"></span><br><span class="line">execute(self, query, args&#x3D;None) method of MySQLdb.cursors.Cursor instance</span><br><span class="line">    Execute a query.</span><br><span class="line"></span><br><span class="line">    query -- string, query to execute on server</span><br><span class="line">    args -- optional sequence or mapping, parameters to use with query.</span><br><span class="line"></span><br><span class="line">    Note: If args is a sequence, then %s must be used as the</span><br><span class="line">    parameter placeholder in the query. If a mapping is used,</span><br><span class="line">    %(key)s must be used as the placeholder.</span><br></pre></td></tr></table></figure>

<p>有个参数<code>args</code>，默认是none，其实我们每次涉及到SQL拼接的时候都应该带上这个参数。这才是安全的。 </p>
<p>所以需要修改两个函数</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">def mysql_execute(conn, sql,args):</span><br><span class="line">    cur &#x3D; conn.cursor()</span><br><span class="line">    try:</span><br><span class="line">        cur.execute(sql,args)</span><br><span class="line">        conn.commit()</span><br><span class="line">    except:</span><br><span class="line">        conn.rollback()</span><br><span class="line">    if cur:</span><br><span class="line">        cur.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def insert_mysql(sql):</span><br><span class="line">    conn &#x3D; conn_mysql()</span><br><span class="line">    mysql_execute(conn, sql,args)</span><br><span class="line">    conn.close()</span><br></pre></td></tr></table></figure>

<p>调用方式如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">args &#x3D; (id, name)</span><br><span class="line">cur.execute(&#39;select id,name from user where id &#x3D; %s and name &#x3D; %s&#39;, args )</span><br></pre></td></tr></table></figure>

<p>但是这样的话<code>select</code>后边的字段名不能用占位符替代，只能是<code>where</code>后面的变量 不过没有太大关系。</p>
<p>顺便说说 防止SQL注入的策略：</p>
<ul>
<li>可以对用户输入内容进行判断，关键词进行筛选</li>
<li>数据库权限隔离</li>
<li>后端代码预防</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/12/18/%E4%BD%BF%E7%94%A8parted%E7%BB%99%E7%A1%AC%E7%9B%98%E5%88%86%E5%8C%BA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/12/18/%E4%BD%BF%E7%94%A8parted%E7%BB%99%E7%A1%AC%E7%9B%98%E5%88%86%E5%8C%BA/" class="post-title-link" itemprop="url">使用parted给硬盘分区</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-18 16:29:07" itemprop="dateCreated datePublished" datetime="2017-12-18T16:29:07+08:00">2017-12-18</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E5%9F%BA%E7%A1%80%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">基础运维</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>首先磁盘的分区方式分为MBR和GPT。<br>而二者有何区别？</p>
<h2 id="MBR"><a href="#MBR" class="headerlink" title="MBR"></a>MBR</h2><p>最早的磁盘分区表都是MBR的全称是Master Boot Record（主引导记录），之所以叫“主引导记录”，是因为它是存在于驱动器开始部分的一个特殊的启动扇区。这个扇区包含了已安装的操作系统的启动加载器和驱动器的逻辑分区信息。<br>我们面试的时候可能会问到Linux系统的启动过程，然后当时可能都会说，</p>
<p><strong>通电BIOS–&gt;加载MBR主引导记录–&gt;操作系统–&gt;加载内核。。。。</strong></p>
<p>其中BIOS（Basic Input/Output System）是烫在内存上的代码，很少一部分空间，所以要做的事儿很少也都是写死的，（目前BIOS因为空间很小等，存在很大的局限性，正在被取代）BIOS 必须确定要使用哪个设备来引导系统。当找到一个引导设备之后，第一阶段的引导加载程序就被装入 RAM 并执行。这个引导加载程序（第一个扇区即MBR），其作用是加载第二阶段的引导加载程序。</p>
<p><code>MBR</code>是由分区程序（如Fdisk，Parted）所产生的，它不依赖任何操作系统，而且硬盘引导程序也是可以改变的，从而能够实现多系统引导。</p>
<p>“主引导记录”只有64个字节，放不了太多东西。它的主要作用是，<code>告诉计算机到硬盘的哪一个位置去找操作系统。</code></p>
<p>主引导记录由三个部分组成：</p>
<p>　　（1） 第1-446字节：调用操作系统的机器码。</p>
<p>　　（2） 第447-510字节：分区表（Partition table）。</p>
<p>　　（3） 第511-512字节：主引导记录签名（0x55和0xAA）。</p>
<p>其中<code>MBR</code>目前对于我们运维来说，最大的局限就在于<strong>在MBR分区表中，一个分区最大的容量为2T</strong>,所以我们想要做一个大于2.2T的分区，只能用GPT。</p>
<h2 id="GPT"><a href="#GPT" class="headerlink" title="GPT"></a>GPT</h2><p><a href="https://zh.wikipedia.org/wiki/GUID%E7%A3%81%E7%A2%9F%E5%88%86%E5%89%B2%E8%A1%A8">wikipedia地址</a></p>
<p>简言之。GPT就是用来替代MBR的，Intel计划用<code>UEFI+GPT</code> 代替 <code>BIOS+MBR</code>,因为MBR不支持2.2T以上的硬盘的分区。<br>全局唯一标识分区表（GUID Partition Table，缩写：GPT）是一个实体硬盘的分区结构。它是EFI(可扩展固件接口标准)的一部分，用来替代BIOS中的主引导记录分区表。<br>在MBR硬盘中，分区信息直接存储于主引导记录(MBR)中（主引导记录中还存储着系统的引导程序）。但在GPT硬盘中，分区表的位置信息储存在GPT头中。但出于兼容性考虑，硬盘的第一个扇区仍然用作MBR，之后才是GPT头。</p>
<p>所以相比<code>MBR</code>,<code>GPT</code>具有以下优点</p>
<ul>
<li>突破MBR 4个主分区限制，每个磁盘最多支持128个主分区。</li>
<li>支持大于2T的分区，最大卷可达18EB。</li>
</ul>
<h2 id="UEFI"><a href="#UEFI" class="headerlink" title="UEFI"></a>UEFI</h2><p>是由EFI1.10为基础发展起来的，它的所有者已不再是Intel，而是一个称作Unified EFI Form的国际组织，贡献者有Intel，Microsoft，AMI，等几个大厂，属于open source。</p>
<h2 id="parted-对GPT分区"><a href="#parted-对GPT分区" class="headerlink" title="parted 对GPT分区"></a>parted 对GPT分区</h2><p>fdisk命令对于大于2T的分区无法划分，所以用fdisk无法看到parted划分的GPT格式的分区。</p>
<p>parted是一个可以分区并进行分区调整的工具，他可以创建，破坏，移动，复制，调整ext2 linux-swap fat fat32 reiserfs类型的分区，可以创建，调整，移动Macintosh的HFS分区，检测jfs，ntfs，ufs，xfs分区。</p>
<p>实际使用parted可以像fdisk一样交互进行，也可以使用命令行的模式。<br>我只记录了命令行模式</p>
<p><strong>首先查看当前分区情况</strong></p>
<pre><code>parted -l</code></pre><p><strong>创建新的分区表</strong></p>
<pre><code>mklabel [label-type]
例：
parted -m /dev/sdb mklabel gpt
// parted -m 打印出方便机器解析的输出 设备名 mklabel 分区表type</code></pre><p><strong>创建新的分区</strong></p>
<pre><code>mkpart [part-type [fs-type] start end]
例：
parted /dev/sda mkpart data ext3 93.5GB 100%
// parted 设备名 mkpart 分区名 文件系统（不支持ext4,xfs） 开始位置（如果磁盘有其他分区需要查看其他分区结束位置） 结束位置</code></pre><p><strong>删除分区</strong></p>
<pre><code>rm 分区名</code></pre><p>创建分区表，与新建分区可以合成一条命令</p>
<pre><code>parted /dev/sdb mklabel gpt mkpart data ext3 93.5GB 100%</code></pre><p>parted分区之前需要卸载磁盘 ，如果所有的硬盘分为一个raid，只有一个/dev/sda 的话 </p>
<ul>
<li><p>执行parted分区命令</p>
<p>  parted /dev/sda mkpart data 93.5GB 100%</p>
</li>
</ul>
<p>-重启生效</p>
<pre><code>reboot</code></pre><ul>
<li><p>格式化，这个时候可以使用xfs或者ext4（因为parted本身不支持xfs和ext4）</p>
<p> /sbin/mkfs.xfs -f /dev/sdan</p>
</li>
<li><p>挂载</p>
</li>
</ul>
<p>mount /dev/sda6 /data</p>
<ul>
<li><p>写进fstab，重启生效    </p>
<p>  echo “/dev/sda6               /data                   xfs    defaults        1 2” &gt;&gt; /etc/fstab  </p>
</li>
</ul>
<p>参考：<br><a href="http://www.g33knotes.org/2013/07/creating-aligned-xfs-partition-using.html">http://www.g33knotes.org/2013/07/creating-aligned-xfs-partition-using.html</a><br><a href="https://www.ibm.com/developerworks/cn/linux/l-lpic1-104-1/index.html">https://www.ibm.com/developerworks/cn/linux/l-lpic1-104-1/index.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/12/12/Django%E6%A8%A1%E6%9D%BF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/12/12/Django%E6%A8%A1%E6%9D%BF/" class="post-title-link" itemprop="url">Django模板</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-12 14:56:24" itemprop="dateCreated datePublished" datetime="2017-12-12T14:56:24+08:00">2017-12-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>最近有个Django的项目移交到我手上，虽然去年春雨后台都是Django框架，但是我只写过两个command工具，并没有写过工程代码。前端更是一直有心无力。</p>
<p>接手的这个工程，虽然功能还算简单，我也照本宣科的实现了自己想要的功能（借助之前别人的前端代码）。<br>但是那个lowbi的外观我接受不了。所以我想自己折腾下，把自己的功能剥离出来单独实现。<br>做下记录。。</p>
<p><strong>首先介绍下Django模板。。</strong></p>
<blockquote>
<p>Django模板是一个string文本，它用来分离一个文档的展现和数据<br>模板定义了placeholder和表示多种逻辑的tags来规定文档如何展现<br>通常模板用来输出HTML，template本质是HTML，但是中间夹杂着一些变量，和模板标签。</p>
</blockquote>
<h2 id="模板标签"><a href="#模板标签" class="headerlink" title="模板标签"></a>模板标签</h2><p><strong>变量</strong><br>例  可以是自己定义的变量，也可以是后端渲染过来的，可以使string,也可以是list,dic甚至类,然后通过<code>.key</code>,<code>.方法</code>来获取值</p>
<p>当template遇到. 之后的查找顺序</p>
<ol>
<li>字典查找，如foo[“bar”]</li>
<li>属性查找，如foo.bar</li>
<li>方法调用，如foo.bar()</li>
<li>列表的索引查找，如foo[bar]</li>
</ol>
<p><strong>块标签</strong><br>常见标签：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">- if 标签</span><br><span class="line"></span><br><span class="line">    &#123;% if condition %&#125; todo &#123;% endif %&#125;</span><br><span class="line"></span><br><span class="line">- for 标签</span><br><span class="line">    </span><br><span class="line">    &#123;% for name in names %&#125; todo &#123;% endfor %&#125;</span><br><span class="line"></span><br><span class="line">- ifequal&#x2F;ifnotequal 标签 </span><br><span class="line">    用来比较两个值当他们相等&#x2F;不等时 显示todo</span><br><span class="line"></span><br><span class="line">    &#123;% ifequal user currentuser %&#125; todo &#123;% endifequal %&#125;</span><br><span class="line"></span><br><span class="line">- 注释标签</span><br><span class="line"></span><br><span class="line">    &#123;# content #&#125;</span><br><span class="line"></span><br><span class="line">- 过滤器</span><br><span class="line"></span><br><span class="line">- includ</span><br><span class="line"></span><br><span class="line">- 模板继承</span><br><span class="line"></span><br><span class="line">一般我们建的网站标题，导航，或者底部都是一致的，这就可以写一个&#96;base.html&#96; 用来继承。</span><br><span class="line">首先&#96;base.html&#96; 可以这样写</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;&#123;% block title %&#125;默认标题&#123;% endblock %&#125; &lt;&#x2F;title&gt;</span><br><span class="line">&lt;&#x2F;head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line"> </span><br><span class="line"> </span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">&lt;div&gt;这里是默认内容，所有继承自这个模板的，如果不覆盖就显示这里的默认内容。&lt;&#x2F;div&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br><span class="line"> </span><br><span class="line">&lt;&#x2F;body&gt;</span><br><span class="line">&lt;&#x2F;html&gt;</span><br></pre></td></tr></table></figure>

<p><code>{% block  %} content {% endblock %}</code>内的内容即可被继承。</p>
<p>然后写一个<code>index.html</code>，用{% extend 'base.html' %}来继承。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;% extends &#39;base.html&#39; %&#125;</span><br><span class="line"> </span><br><span class="line">&#123;% block title %&#125;欢迎光临首页&#123;% endblock %&#125;</span><br><span class="line"> </span><br><span class="line">&#123;% block content %&#125;</span><br><span class="line">&lt;h1&gt; hello world &lt;&#x2F;h1&gt;</span><br><span class="line">&#123;% endblock %&#125;</span><br></pre></td></tr></table></figure>

<p>我们一般的流程就是从view函数把数据渲染到模板然后展示下边我们模拟下这个过程。</p>
<p>Django新建工程,APP 过程省略。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/12/04/python%E8%B0%83%E7%94%A8API/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/12/04/python%E8%B0%83%E7%94%A8API/" class="post-title-link" itemprop="url">python调用API</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-12-04 11:27:25" itemprop="dateCreated datePublished" datetime="2017-12-04T11:27:25+08:00">2017-12-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/python/" itemprop="url" rel="index"><span itemprop="name">python</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>API是Application Programming Interface（应用程序界面）的缩写.很多服务或者软件都有提供，并提供相应的使用文档。我们可以使用这些<code>HTTP API</code>来进行增删改查。</p>
</blockquote>
<p>如果你也是个系统运维，我相信你可能目前为止没有尝试过服务器后端开发，没有用<code>flask</code>或者<code>Django</code>框架做过开发，但是你肯定听说过或者使用过<code>RESTful API</code>。</p>
<p>再如果你现在公司使用的是open-falcon，上传监控数据的时候都需要去调用API，或者falcon-plus，都可以通过API去添加报警，更改策略等。。</p>
<p>强烈建议下载<code>postman</code>来调试<br><img src="http://or2jd66dq.bkt.clouddn.com/15123764582022.jpg" alt=""></p>
<p>代码查看，有多中语言包括shell,PHP，Java，go，python<br><img src="http://or2jd66dq.bkt.clouddn.com/15123765006158.jpg" alt=""></p>
<p>以上postman的代码可以直接使用。。requests 用起来很顺手。<br>但是。<br>下边。。<br>我们以python2的urllib2库 为例分别以各种场景记录下。。</p>
<h2 id="GET-请求"><a href="#GET-请求" class="headerlink" title="GET 请求"></a>GET 请求</h2><p>最简单的例子. urllib2.urlopen(url[, data][, timeout]) 参数URL 既可以为字符创url也可以是一个request对象。</p>
<pre><code>import urllib2
response = urllib2.urlopen(&apos;http://python.org/&apos;)
html = response.read()

或者

import urllib2
req = urllib2.Request(&apos;http://python.org/&apos;)
response = urllib2.urlopen(req)
the_page = response.read()</code></pre><p>第二个例子用到了urllib.Reauest类，只用URL实例化了对象。</p>
<p><strong>添加header</strong><br>一般HTTP请求提交数据，需要编码成 URL编码格式，然后做为url的一部分，或者作为参数传到Request对象中。</p>
<pre><code>import urllib2
req = urllib2.Request(&apos;http://www.example.com/&apos;)
req.add_header(&apos;Referer&apos;, &apos;http://www.python.org/&apos;)
r = urllib2.urlopen(req)</code></pre><p>在实例化Request类之后使用add_header 方法添加header。上面例子添加了一个Referer，说明我们的访问是从<a href="http://www.python.org过来的。其他的header">http://www.python.org过来的。其他的header</a> 类似user-agent， 都可以调用<code>add_header(key,value)</code>方法添加.</p>
<p><strong>用户名密码登录验证</strong></p>
<p>用户在登录之后，服务器端会为该用户创建一个Session。Session相当于该用户的档案。该档案就代表着该用户。<br>那么某一次访问请求是属于该用户呢？登录的时候服务器要求浏览器储存了一个Session ID的Cookie值。每一个访问都带上了该Cookie。服务器将Cookie中的Session ID与服务器中的Session ID比对就知道该请求来自哪个用户了。<a href="http://blog.csdn.net/fangaoxin/article/details/6952954/">具体参考</a><br>我们在调用urllib2.urlopen(url)的时候，其实urllib2在open函数内部创建了一个默认的opener对象。然后调用opener.open()函数。但是默认opener不支持cookie。<br>我们需要使用<code>HTTPCookieProcessor</code></p>
<p>以下一个模拟登录zabbix的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import urllib2</span><br><span class="line">import cookielib</span><br><span class="line">import urllib</span><br><span class="line"></span><br><span class="line">#定义登录地址</span><br><span class="line">login_url &#x3D; &#39;http:&#x2F;&#x2F;10.16.2.4&#x2F;zabbix&#x2F;index.php&#39;</span><br><span class="line">#定义登录所需要用的信息，如用户名、密码等，详见下图，使用urllib进行编码</span><br><span class="line"></span><br><span class="line">login_data &#x3D; urllib.urlencode(&#123;</span><br><span class="line">                        &quot;name&quot;: &#39;admin&#39;,</span><br><span class="line">                        &quot;password&quot;: &#39;password&#39;,</span><br><span class="line">                        &quot;autologin&quot;: 1,</span><br><span class="line">                        &quot;enter&quot;: &quot;Sign in&quot;&#125;)</span><br><span class="line"></span><br><span class="line">#设置一个cookie处理器，它负责从服务器下载cookie到本地，并且在发送请求时带上本地的cookie  </span><br><span class="line">cj &#x3D; cookielib.CookieJar() #获取Cookiejar对象（存在本机的cookie消息）</span><br><span class="line">opener &#x3D; urllib2.build_opener(urllib2.HTTPCookieProcessor(cj)) #自定义opener,并将opener跟CookieJar对象绑定</span><br><span class="line">urllib2.install_opener(opener) #安装opener,此后调用urlopen()时都会使用安装过的opener对象</span><br><span class="line">response&#x3D;opener.open(login_url,login_data).read() #访问登录页，自动带着cookie信息</span><br><span class="line">print response #返回登陆后的页面源代码</span><br></pre></td></tr></table></figure>



<h2 id="POST请求"><a href="#POST请求" class="headerlink" title="POST请求"></a>POST请求</h2><p>还是使用Request类，将参数放置到data中，data是一个字典，里面要匹配键值对。</p>
<pre><code>headers = {&apos;Content-Type&apos;: &apos;application/json&apos;}
params = {&apos;username&apos;: &quot;username&quot;, &apos;password&apos;: &quot;password&quot;}
data = json.dumps(params)
req = urllib2.Request(url, data, headers)  #POST</code></pre><blockquote>
<p>Content-Length: 144： 是指发送的表单数据长度为144，也就是字符个数是144个。<br>X-Requested-With: XMLHttpRequest ：表示Ajax异步请求。<br>Content-Type: application/x-www-form-urlencoded ： 表示浏览器提交 Web 表单时使用，表单数据会按照 name1=value1&amp;name2=value2 键值对形式进行编码。</p>
</blockquote>
<h2 id="代理proxy"><a href="#代理proxy" class="headerlink" title="代理proxy"></a>代理proxy</h2><p>如果你想要去爬取1024上的图片的话，兄弟你可能需要设置代理。</p>
<p><a href="http://www.xicidaili.com/">西刺免费代理IP</a><br><a href="http://www.goubanjia.com/free/index.shtml">全网代理IP</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">import urllib2</span><br><span class="line">import random</span><br><span class="line"></span><br><span class="line">proxy_list &#x3D; [</span><br><span class="line">    &#123;&quot;http&quot; : &quot;124.88.67.81:80&quot;&#125;,</span><br><span class="line">    &#123;&quot;http&quot; : &quot;124.88.67.82:80&quot;&#125;,</span><br><span class="line">    &#123;&quot;http&quot; : &quot;124.88.67.83:80&quot;&#125;,</span><br><span class="line">    &#123;&quot;http&quot; : &quot;124.88.67.84:80&quot;&#125;,</span><br><span class="line">    &#123;&quot;http&quot; : &quot;124.88.67.85:80&quot;&#125;</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"># 随机选择一个代理</span><br><span class="line">proxy &#x3D; random.choice(proxy_list)</span><br><span class="line"># 使用选择的代理构建代理处理器对象</span><br><span class="line">httpproxy_handler &#x3D; urllib2.ProxyHandler(proxy)</span><br><span class="line"></span><br><span class="line">opener &#x3D; urllib2.build_opener(httpproxy_handler)</span><br><span class="line"></span><br><span class="line">request &#x3D; urllib2.Request(&quot;http:&#x2F;&#x2F;www.baidu.com&#x2F;&quot;)</span><br><span class="line">response &#x3D; opener.open(request)</span><br><span class="line">print response.read()</span><br></pre></td></tr></table></figure>

<p>如果是自己花钱买的有密码的代理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">import urllib2</span><br><span class="line">import urllib</span><br><span class="line"></span><br><span class="line"># 私密代理授权的账户</span><br><span class="line">user &#x3D; &quot;mr_mao_hacker&quot;</span><br><span class="line"># 私密代理授权的密码</span><br><span class="line">passwd &#x3D; &quot;sffqry9r&quot;</span><br><span class="line"># 私密代理 IP</span><br><span class="line">proxyserver &#x3D; &quot;61.158.163.130:16816&quot;</span><br><span class="line"></span><br><span class="line"># 1. 构建一个密码管理对象，用来保存需要处理的用户名和密码</span><br><span class="line">passwdmgr &#x3D; urllib2.HTTPPasswordMgrWithDefaultRealm()</span><br><span class="line"></span><br><span class="line"># 2. 添加账户信息，第一个参数realm是与远程服务器相关的域信息，一般没人管它都是写None，后面三个参数分别是 代理服务器、用户名、密码</span><br><span class="line">passwdmgr.add_password(None, proxyserver, user, passwd)</span><br><span class="line"></span><br><span class="line"># 3. 构建一个代理基础用户名&#x2F;密码验证的ProxyBasicAuthHandler处理器对象，参数是创建的密码管理对象</span><br><span class="line">#   注意，这里不再使用普通ProxyHandler类了</span><br><span class="line"></span><br><span class="line">proxyauth_handler &#x3D; urllib2.ProxyBasicAuthHandler(passwdmgr)</span><br><span class="line"></span><br><span class="line"># 4. 通过 build_opener()方法使用这些代理Handler对象，创建自定义opener对象，参数包括构建的 proxy_handler 和 proxyauth_handler</span><br><span class="line">opener &#x3D; urllib2.build_opener(proxyauth_handler)</span><br><span class="line"></span><br><span class="line"># 5. 构造Request 请求</span><br><span class="line">request &#x3D; urllib2.Request(&quot;http:&#x2F;&#x2F;www.baidu.com&#x2F;&quot;)</span><br><span class="line"></span><br><span class="line"># 6. 使用自定义opener发送请求</span><br><span class="line">response &#x3D; opener.open(request)</span><br><span class="line"></span><br><span class="line"># 7. 打印响应内容</span><br><span class="line">print response.read()</span><br></pre></td></tr></table></figure>

<p>如果你使用的shadowsocket,解决方案有两个，</p>
<ol>
<li>把ss设置成全局模式再跑脚本。</li>
<li><a href="https://www.thinksaas.cn/group/topic/518333/">看这里</a></li>
</ol>
<p><strong>结束语：</strong><br>puthon3 Requests模块更好用。。。 <a href="http://fuandenghuo.com/2017/08/23/Requests-%E6%A8%A1%E5%9D%97/">参考</a></p>
<p>参考：<a href="http://www.jianshu.com/p/02bda3bc14d4?utm_campaign=maleskine&utm_content=note&utm_medium=pc_all_hots&utm_source=recommendation">Handler处理器 和 自定义Opener</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="fanquqi.github.io/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="fanquqi.github.io/">1</a><span class="page-number current">2</span><a class="page-number" href="fanquqi.github.io/page/3/">3</a><span class="space">&hellip;</span><a class="page-number" href="fanquqi.github.io/page/8/">8</a><a class="extend next" rel="next" href="fanquqi.github.io/page/3/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">fanquqi</p>
  <div class="site-description" itemprop="description">Raise my flag to the new age.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="fanquqi.github.io/archives/">
        
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fanquqi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="fanquqi.github.io/lib/anime.min.js"></script>
  <script src="fanquqi.github.io/lib/velocity/velocity.min.js"></script>
  <script src="fanquqi.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="fanquqi.github.io/js/utils.js"></script>

<script src="fanquqi.github.io/js/motion.js"></script>


<script src="fanquqi.github.io/js/schemes/muse.js"></script>


<script src="fanquqi.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
