<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="fanquqi.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="fanquqi.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="fanquqi.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="fanquqi.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="fanquqi.github.io/css/main.css">


<link rel="stylesheet" href="fanquqi.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fanquqi.github.io","root":"fanquqi.github.io/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Raise my flag to the new age.">
<meta property="og:type" content="website">
<meta property="og:title" content="fix u dream">
<meta property="og:url" content="https://fanquqi.github.io/page/7/index.html">
<meta property="og:site_name" content="fix u dream">
<meta property="og:description" content="Raise my flag to the new age.">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="fanquqi">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://fanquqi.github.io/page/7/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>fix u dream</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="fanquqi.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">fix u dream</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="fanquqi.github.io/" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="fanquqi.github.io/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/15/Logstash%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/15/Logstash%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">Logstash优化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-15 15:59:39" itemprop="dateCreated datePublished" datetime="2017-06-15T15:59:39+08:00">2017-06-15</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E5%9F%BA%E7%A1%80%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">基础运维</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>之前部署的ELK只加了nginx_access, elapsed两个日志，每天的日志量有400G左右，架构可以撑住。但是现在又引入了一些新的日志，并且随着SEO部门的来临。每天晚上服务都被爬虫爬。日志量也翻了两三翻。产生了日志延时的问题。有的延时能有几个小时。<br><img src="http://or2jd66dq.bkt.clouddn.com/kibana%E5%BB%B6%E6%97%B6.png" alt=""><br>看kibana中上传的时间跟日志里的时间差距好几个小时。说明日志已经阻塞了。</p>
</blockquote>
<h2 id="问题分析"><a href="#问题分析" class="headerlink" title="问题分析"></a>问题分析</h2><p>这期间机器负载啥的一直也没有报警，ES集群也很健康，所以初步估计是logstash遇到了瓶颈。因为我们有grok，之前就听说这个过滤会对速度影响很大，还有geoip等。</p>
<h2 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h2><p>我第一想到的是，收集日志换成<code>filebeat</code>然后像之前加的syslog一样放到kafka缓冲一下，再用logstash插入到ES，但是无奈，机器资源有限，kafka又是直接写问加你系统，运维机的磁盘已经很满了，在扩容磁盘之前是无望了。所以现在只能优化一下logstash，坚持到磁盘扩容。</p>
<h2 id="logstash优化"><a href="#logstash优化" class="headerlink" title="logstash优化"></a>logstash优化</h2><ul>
<li>加大内存</li>
<li>增加线程</li>
<li>减少grok或者去掉geoip定位</li>
</ul>
<p>另外更改@timestamp 参考:<a href="http://udn.yyuap.com/doc/logstash-best-practice-cn/filter/date.html">http://udn.yyuap.com/doc/logstash-best-practice-cn/filter/date.html</a><br>为了防止每次延时比较大的时候图像显示不准确。</p>
<h2 id="配置统一管理"><a href="#配置统一管理" class="headerlink" title="配置统一管理"></a>配置统一管理</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/13/Blog%E6%94%B6%E8%97%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/13/Blog%E6%94%B6%E8%97%8F/" class="post-title-link" itemprop="url">Blog收藏</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-13 17:34:37" itemprop="dateCreated datePublished" datetime="2017-06-13T17:34:37+08:00">2017-06-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>以上的博客并无排名，只是随着自己发现的时间排序</p>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><ul>
<li><a href="http://coolshell.cn/">酷壳</a></li>
<li><a href="http://blog.xiaorui.cc/">峰云</a></li>
<li><a href="http://www.xuliangwei.com/">徐亮偉架构师之路</a></li>
</ul>
<h2 id="运维"><a href="#运维" class="headerlink" title="运维"></a>运维</h2><ul>
<li><a href="https://www.iamle.com/">流水理鱼</a></li>
<li><a href="http://www.xiaoh.me/">pmars</a> </li>
<li><a href="http://blog.51reboot.com/">reboot</a></li>
<li><a href="http://axiaoxin.com/">阿小信的博客</a></li>
</ul>
<h2 id="安全"><a href="#安全" class="headerlink" title="安全"></a>安全</h2><ul>
<li><a href="https://www.leavesongs.com/">离别歌</a></li>
</ul>
<h2 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h2><ul>
<li><p><a href="http://pinkyjie.com/">进击的马斯特</a></p>
</li>
<li><p><a href="https://imququ.com/">Jerry Qu</a></p>
</li>
</ul>
<h2 id="python"><a href="#python" class="headerlink" title="python"></a>python</h2><ul>
<li><a href="http://www.cnblogs.com/alex3714/">alex</a></li>
</ul>
<h2 id="系统管理员资源大全"><a href="#系统管理员资源大全" class="headerlink" title="系统管理员资源大全"></a>系统管理员资源大全</h2><ul>
<li><a href="https://my.oschina.net/HeAlvin/blog/378262">系统管理员资源大全</a></li>
</ul>
<h2 id="大厂经验"><a href="#大厂经验" class="headerlink" title="大厂经验"></a>大厂经验</h2><ul>
<li><a href="http://jm.taobao.org/">阿里中间件</a></li>
<li><a href="https://tech.meituan.com/">美团技术点评团队</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/12/uwsgi-worker%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/12/uwsgi-worker%E7%9B%91%E6%8E%A7%E8%84%9A%E6%9C%AC/" class="post-title-link" itemprop="url">uwsgi_worker监控脚本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-12 14:58:24" itemprop="dateCreated datePublished" datetime="2017-06-12T14:58:24+08:00">2017-06-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E8%84%9A%E6%9C%AC/" itemprop="url" rel="index"><span itemprop="name">脚本</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>该脚本为falcon上报uwsgi的监控数据，总worker数，busy_worker数，busy率。 需要写到cron中定时去跑。push过程忽略，使用的为内部封装的op_tools包。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"># Ansible managed: &#x2F;data&#x2F;home&#x2F;chunyu_sys&#x2F;workspace&#x2F;cy_ansible&#x2F;roles&#x2F;zabbix_agent&#x2F;templates&#x2F;uwsgi_busy_count.py.j2 modified on 2016-09-14 23:41:10 by chunyu_sys on control</span><br><span class="line"># Do NOT modify this file by hand!</span><br><span class="line">import socket</span><br><span class="line">import json</span><br><span class="line">import sys</span><br><span class="line">from op_tools import falcon</span><br><span class="line"></span><br><span class="line">project_or_socket &#x3D; &quot;medweb&quot;</span><br><span class="line"></span><br><span class="line">uwsgi_map &#x3D; &#123;&#125;</span><br><span class="line"></span><br><span class="line">uwsgi_map[&#39;medweb&#39;]&#x3D;&#39;&#x2F;home&#x2F;chunyu&#x2F;workspace&#x2F;medweb&#x2F;log&#x2F;uwsgi_stats.socket&#39;</span><br><span class="line">uwsgi_map[&#39;cmsapi&#39;]&#x3D;&#39;&#x2F;tmp&#x2F;stats_cmsapi.socket&#39;</span><br><span class="line"></span><br><span class="line">addr &#x3D; uwsgi_map.get(project_or_socket, project_or_socket)</span><br><span class="line">data_type &#x3D; &quot;busy&quot;</span><br><span class="line"></span><br><span class="line">sfamily &#x3D; socket.AF_UNIX</span><br><span class="line">s &#x3D; socket.socket(sfamily, socket.SOCK_STREAM)</span><br><span class="line">s.connect(addr)</span><br><span class="line"></span><br><span class="line">js &#x3D; &quot;&quot;</span><br><span class="line"></span><br><span class="line">while True:</span><br><span class="line">    data &#x3D; s.recv(4096)</span><br><span class="line">    if len(data) &lt; 1:</span><br><span class="line">        break</span><br><span class="line">    js +&#x3D; data.decode(&#39;utf8&#39;)</span><br><span class="line"></span><br><span class="line">dd &#x3D; json.loads(js)</span><br><span class="line">workers &#x3D; dd[&quot;workers&quot;]</span><br><span class="line">busy_count &#x3D; 0</span><br><span class="line">total_count &#x3D; len(workers)</span><br><span class="line"></span><br><span class="line">for worker in workers:</span><br><span class="line">   if worker[&quot;status&quot;] &#x3D;&#x3D; &quot;busy&quot;:</span><br><span class="line">       busy_count +&#x3D; 1</span><br><span class="line"></span><br><span class="line">busy_rate &#x3D; busy_count&#x2F;float(total_count or 1)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dic_count &#x3D; &#123;</span><br><span class="line">    &#39;busy_count&#39; : busy_count,</span><br><span class="line">    &#39;busy_rate&#39; : busy_rate,</span><br><span class="line">    &#39;total_count&#39; : total_count,</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">metric &#x3D; &quot;medweb_uwsgi_busy_worker&quot;</span><br><span class="line">collect_step &#x3D; 60</span><br><span class="line">counter_type &#x3D; falcon.CounterType.GAUGE</span><br><span class="line"></span><br><span class="line">for key  in dic_count:</span><br><span class="line">    tag &#x3D; &quot;type&#x3D;&quot; + key</span><br><span class="line"></span><br><span class="line">    value &#x3D; dic_count.get(key)</span><br><span class="line">    info &#x3D; falcon.build_metric_info(metric, value, collect_step, counter_type, tags&#x3D;tag)</span><br><span class="line">    print info</span><br><span class="line">    falcon.push_metric_info_list_to_falcon([info])</span><br></pre></td></tr></table></figure>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/09/%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%E4%B9%8Bsar%E5%91%BD%E4%BB%A4/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/09/%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7%E4%B9%8Bsar%E5%91%BD%E4%BB%A4/" class="post-title-link" itemprop="url">运维工具之sar命令</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-09 15:48:43" itemprop="dateCreated datePublished" datetime="2017-06-09T15:48:43+08:00">2017-06-09</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E5%9F%BA%E7%A1%80%E8%BF%90%E7%BB%B4/" itemprop="url" rel="index"><span itemprop="name">基础运维</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考:<a href="http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/index.html">http://linuxtools-rst.readthedocs.io/zh_CN/latest/tool/index.html</a></p>
<p>sar是System Activity Reporter（系统活动情况报告）的缩写。sar工具将对系统当前的状态进行取样，然后通过计算数据和比例来表达系统的当前运行状态。它的特点是可以连续对系统取样，获得大量的取样数据；取样数据和分析的结果都可以存入文件，所需的负载很小。sar是目前Linux上最为全面的系统性能分析工具之一，可以从14个大方面对系统的活动进行报告，包括文件的读写情况、系统调用的使用情况、串口、CPU效率、内存使用状况、进程活动及IPC有关的活动等，使用也是较为复杂。</p>
<p>sar是查看操作系统报告指标的各种工具中，最为普遍和方便的；它有两种用法；</p>
<ol>
<li>追溯过去的统计数据（默认）</li>
<li>周期性的查看当前数据</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/08/falcon%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/08/falcon%E9%97%AE%E9%A2%98%E5%A4%84%E7%90%86/" class="post-title-link" itemprop="url">falcon问题处理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-08 16:14:29" itemprop="dateCreated datePublished" datetime="2017-06-08T16:14:29+08:00">2017-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E7%9B%91%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">监控</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="grafana上面不支持open-falcon的大写metric-mymon-metric更改小写"><a href="#grafana上面不支持open-falcon的大写metric-mymon-metric更改小写" class="headerlink" title="grafana上面不支持open-falcon的大写metric(mymon metric更改小写)"></a>grafana上面不支持open-falcon的大写metric(mymon metric更改小写)</h2><blockquote>
<p>(这是openfalcon的bug，falcon-plus中已经修复)</p>
</blockquote>
<p>但是我们现在使用的falcon没有升级，而且升级的得计划暂时没有安排。我们只能手动更改metric不用大写尽量用小写。<br>以下记录mymon更改。<br><strong>mymon</strong>是使用go语言编写的，用来监控mysql的插件。<a href="https://github.com/open-falcon/mymon">mymon代码链接</a><br>由于之前的mymon是通过ansible 脚本直接git pull下来的，所以有源码在，可以更改之后再build一下。<br>找到<code>metric.go</code>修改大写的metric为小写。 修改完脚本如下。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br></pre></td><td class="code"><pre><span class="line">package main</span><br><span class="line"></span><br><span class="line">import (</span><br><span class="line">    &quot;fmt&quot;</span><br><span class="line">    &quot;os&quot;</span><br><span class="line">    &quot;time&quot;</span><br><span class="line">    &quot;strings&quot; #添加string</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">const (</span><br><span class="line">    TIME_OUT &#x3D; 30</span><br><span class="line"></span><br><span class="line">    ORIGIN   &#x3D; &quot;GAUGE&quot;</span><br><span class="line">    DELTA_PS &#x3D; &quot;COUNTER&quot;</span><br><span class="line">    DELTA    &#x3D; &quot;&quot;</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; COUNTER: Speed per second</span><br><span class="line">&#x2F;&#x2F; GAUGE: Original, DEFAULT</span><br><span class="line">var DataType &#x3D; map[string]string&#123;</span><br><span class="line">    &quot;Innodb_buffer_pool_reads&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Innodb_buffer_pool_read_requests&quot;: DELTA_PS,</span><br><span class="line">    &quot;Innodb_compress_time&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Innodb_data_fsyncs&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Innodb_data_read&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Innodb_data_reads&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Innodb_data_writes&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Innodb_data_written&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Innodb_last_checkpoint_at&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Innodb_log_flushed_up_to&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Innodb_log_sequence_number&quot;:       DELTA_PS,</span><br><span class="line">    &quot;Innodb_mutex_os_waits&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Innodb_mutex_spin_rounds&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Innodb_mutex_spin_waits&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Innodb_pages_flushed_up_to&quot;:       DELTA_PS,</span><br><span class="line">    &quot;Innodb_rows_deleted&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Innodb_rows_inserted&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Innodb_rows_locked&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Innodb_rows_modified&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Innodb_rows_read&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Innodb_rows_updated&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Innodb_row_lock_time&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Innodb_row_lock_waits&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Innodb_uncompress_time&quot;:           DELTA_PS,</span><br><span class="line"></span><br><span class="line">    &quot;Binlog_event_count&quot;: DELTA_PS,</span><br><span class="line">    &quot;Binlog_number&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Slave_count&quot;:        DELTA_PS,</span><br><span class="line"></span><br><span class="line">    &quot;Com_admin_commands&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_assign_to_keycache&quot;:    DELTA_PS,</span><br><span class="line">    &quot;Com_alter_db&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Com_alter_db_upgrade&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_alter_event&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_alter_function&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_alter_procedure&quot;:       DELTA_PS,</span><br><span class="line">    &quot;Com_alter_server&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_alter_table&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_alter_tablespace&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_analyze&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Com_begin&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Com_binlog&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_call_procedure&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_change_db&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Com_change_master&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Com_check&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Com_checksum&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Com_commit&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_create_db&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Com_create_event&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_create_function&quot;:       DELTA_PS,</span><br><span class="line">    &quot;Com_create_index&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_create_procedure&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_create_server&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Com_create_table&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_create_trigger&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_create_udf&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_create_user&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_create_view&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_dealloc_sql&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_delete&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_delete_multi&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_do&quot;:                    DELTA_PS,</span><br><span class="line">    &quot;Com_drop_db&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Com_drop_event&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_drop_function&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Com_drop_index&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_drop_procedure&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_drop_server&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_drop_table&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_drop_trigger&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_drop_user&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Com_drop_view&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Com_empty_query&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_execute_sql&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_flush&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Com_grant&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Com_ha_close&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Com_ha_open&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Com_ha_read&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Com_help&quot;:                  DELTA_PS,</span><br><span class="line">    &quot;Com_insert&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_insert_select&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Com_install_plugin&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_kill&quot;:                  DELTA_PS,</span><br><span class="line">    &quot;Com_load&quot;:                  DELTA_PS,</span><br><span class="line">    &quot;Com_lock_tables&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_optimize&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Com_preload_keys&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_prepare_sql&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_purge&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Com_purge_before_date&quot;:     DELTA_PS,</span><br><span class="line">    &quot;Com_release_savepoint&quot;:     DELTA_PS,</span><br><span class="line">    &quot;Com_rename_table&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_rename_user&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_repair&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_replace&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Com_replace_select&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_reset&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Com_resignal&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Com_revoke&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_revoke_all&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_rollback&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Com_rollback_to_savepoint&quot;: DELTA_PS,</span><br><span class="line">    &quot;Com_savepoint&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Com_select&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_set_option&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_signal&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_show_authors&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_show_binlog_events&quot;:    DELTA_PS,</span><br><span class="line">    &quot;Com_show_binlogs&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_show_charsets&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Com_show_collations&quot;:       DELTA_PS,</span><br><span class="line">    &quot;Com_show_contributors&quot;:     DELTA_PS,</span><br><span class="line">    &quot;Com_show_create_db&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_show_create_event&quot;:     DELTA_PS,</span><br><span class="line">    &quot;Com_show_create_func&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_show_create_proc&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_show_create_table&quot;:     DELTA_PS,</span><br><span class="line">    &quot;Com_show_create_trigger&quot;:   DELTA_PS,</span><br><span class="line">    &quot;Com_show_databases&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_show_engine_logs&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_show_engine_mutex&quot;:     DELTA_PS,</span><br><span class="line">    &quot;Com_show_engine_status&quot;:    DELTA_PS,</span><br><span class="line">    &quot;Com_show_events&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_show_errors&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_show_fields&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_show_function_status&quot;:  DELTA_PS,</span><br><span class="line">    &quot;Com_show_grants&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_show_keys&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Com_show_master_status&quot;:    DELTA_PS,</span><br><span class="line">    &quot;Com_show_open_tables&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_show_plugins&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_show_privileges&quot;:       DELTA_PS,</span><br><span class="line">    &quot;Com_show_procedure_status&quot;: DELTA_PS,</span><br><span class="line">    &quot;Com_show_processlist&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_show_profile&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_show_profiles&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Com_show_relaylog_events&quot;:  DELTA_PS,</span><br><span class="line">    &quot;Com_show_slave_hosts&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_show_slave_status&quot;:     DELTA_PS,</span><br><span class="line">    &quot;Com_show_status&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_show_storage_engines&quot;:  DELTA_PS,</span><br><span class="line">    &quot;Com_show_table_status&quot;:     DELTA_PS,</span><br><span class="line">    &quot;Com_show_tables&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_show_triggers&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Com_show_variables&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_show_warnings&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Com_slave_start&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_slave_stop&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_stmt_close&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_stmt_execute&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_stmt_fetch&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_stmt_prepare&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_stmt_reprepare&quot;:        DELTA_PS,</span><br><span class="line">    &quot;Com_stmt_reset&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_stmt_send_long_data&quot;:   DELTA_PS,</span><br><span class="line">    &quot;Com_truncate&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Com_uninstall_plugin&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Com_unlock_tables&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Com_update&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_update_multi&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Com_xa_commit&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Com_xa_end&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Com_xa_prepare&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_xa_recover&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Com_xa_rollback&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Com_xa_start&quot;:              DELTA_PS,</span><br><span class="line"></span><br><span class="line">    &quot;Aborted_clients&quot;:            DELTA_PS,</span><br><span class="line">    &quot;Aborted_connects&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Access_denied_errors&quot;:       DELTA_PS,</span><br><span class="line">    &quot;Binlog_bytes_written&quot;:       DELTA_PS,</span><br><span class="line">    &quot;Binlog_cache_disk_use&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Binlog_cache_use&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Binlog_stmt_cache_disk_use&quot;: DELTA_PS,</span><br><span class="line">    &quot;Binlog_stmt_cache_use&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Bytes_received&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Bytes_sent&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Connections&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Created_tmp_disk_tables&quot;:    DELTA_PS,</span><br><span class="line">    &quot;Created_tmp_files&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Created_tmp_tables&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Handler_delete&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Handler_read_first&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Handler_read_key&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Handler_read_last&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Handler_read_next&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Handler_read_prev&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Handler_read_rnd&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Handler_read_rnd_next&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Handler_update&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Handler_write&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Opened_files&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Opened_tables&quot;:              DELTA_PS,</span><br><span class="line">    &quot;Opened_table_definitions&quot;:   DELTA_PS,</span><br><span class="line">    &quot;Qcache_hits&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Qcache_inserts&quot;:             DELTA_PS,</span><br><span class="line">    &quot;Qcache_lowmem_prunes&quot;:       DELTA_PS,</span><br><span class="line">    &quot;Qcache_not_cached&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Queries&quot;:                    DELTA_PS,</span><br><span class="line">    &quot;Questions&quot;:                  DELTA_PS,</span><br><span class="line">    &quot;Select_full_join&quot;:           DELTA_PS,</span><br><span class="line">    &quot;Select_full_range_join&quot;:     DELTA_PS,</span><br><span class="line">    &quot;Select_range_check&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Select_scan&quot;:                DELTA_PS,</span><br><span class="line">    &quot;Slow_queries&quot;:               DELTA_PS,</span><br><span class="line">    &quot;Sort_merge_passes&quot;:          DELTA_PS,</span><br><span class="line">    &quot;Sort_range&quot;:                 DELTA_PS,</span><br><span class="line">    &quot;Sort_rows&quot;:                  DELTA_PS,</span><br><span class="line">    &quot;Sort_scan&quot;:                  DELTA_PS,</span><br><span class="line">    &quot;Table_locks_immediate&quot;:      DELTA_PS,</span><br><span class="line">    &quot;Table_locks_waited&quot;:         DELTA_PS,</span><br><span class="line">    &quot;Threads_created&quot;:            DELTA_PS,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type MysqlIns struct &#123;</span><br><span class="line">    Host string</span><br><span class="line">    Port int</span><br><span class="line">    Tag  string</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func dataType(key_ string) string &#123;</span><br><span class="line">    if v, ok :&#x3D; DataType[key_]; ok &#123;</span><br><span class="line">        return v</span><br><span class="line">    &#125;</span><br><span class="line">    return ORIGIN</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">type MetaData struct &#123;</span><br><span class="line">    Metric      string      &#96;json:&quot;metric&quot;&#96;      &#x2F;&#x2F;key</span><br><span class="line">    Endpoint    string      &#96;json:&quot;endpoint&quot;&#96;    &#x2F;&#x2F;hostname</span><br><span class="line">    Value       interface&#123;&#125; &#96;json:&quot;value&quot;&#96;       &#x2F;&#x2F; number or string</span><br><span class="line">    CounterType string      &#96;json:&quot;counterType&quot;&#96; &#x2F;&#x2F; GAUGE  原值   COUNTER 差值(ps)</span><br><span class="line">    Tags        string      &#96;json:&quot;tags&quot;&#96;        &#x2F;&#x2F; port&#x3D;3306,k&#x3D;v</span><br><span class="line">    Timestamp   int64       &#96;json:&quot;timestamp&quot;&#96;</span><br><span class="line">    Step        int64       &#96;json:&quot;step&quot;&#96;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (m *MetaData) String() string &#123;</span><br><span class="line">    s :&#x3D; fmt.Sprintf(&quot;MetaData Metric:%s Endpoint:%s Value:%v CounterType:%s Tags:%s Timestamp:%d Step:%d&quot;,</span><br><span class="line">        m.Metric, m.Endpoint, m.Value, m.CounterType, m.Tags, m.Timestamp, m.Step)</span><br><span class="line">    return s</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func NewMetric(name string) *MetaData &#123;</span><br><span class="line">    return &amp;MetaData&#123;</span><br><span class="line">        Metric:      strings.ToLower(name), #name 改为strings.ToLower(name)</span><br><span class="line">        Endpoint:    hostname(),</span><br><span class="line">        CounterType: dataType(name),</span><br><span class="line">        Tags:        fmt.Sprintf(&quot;port&#x3D;%d&quot;, cfg.Port),</span><br><span class="line">        Timestamp:   time.Now().Unix(),</span><br><span class="line">        Step:        60,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func hostname() string &#123;</span><br><span class="line">    host :&#x3D; cfg.Endpoint</span><br><span class="line">    if host !&#x3D; &quot;&quot; &#123;</span><br><span class="line">        return host</span><br><span class="line">    &#125;</span><br><span class="line">    host, err :&#x3D; os.Hostname()</span><br><span class="line">    if err !&#x3D; nil &#123;</span><br><span class="line">        host &#x3D; cfg.Host</span><br><span class="line">    &#125;</span><br><span class="line">    return host</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">func (m *MetaData) SetValue(v interface&#123;&#125;) &#123;</span><br><span class="line">    m.Value &#x3D; v</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>之后在mymon目录 执行</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">go get .&#x2F;...</span><br><span class="line">go build -o mymon</span><br></pre></td></tr></table></figure>
<p>即可 </p>
<p>之后可以去数据库手动删掉openfalcon 过期的metric(但是新的metric并没有更新，反而旧metric没了数据，可以试着修改endpoint，然后去数据区删除旧的endpoint)</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/08/sublime%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/08/sublime%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">sublime使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-08 15:37:27" itemprop="dateCreated datePublished" datetime="2017-06-08T15:37:27+08:00">2017-06-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">运维工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="mac下zsh直接用sublime打开文件夹"><a href="#mac下zsh直接用sublime打开文件夹" class="headerlink" title="mac下zsh直接用sublime打开文件夹"></a>mac下zsh直接用sublime打开文件夹</h2><p>建一个软链</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ln -s &#x2F;Applications&#x2F;Sublime\ Text.app&#x2F;Contents&#x2F;SharedSupport&#x2F;bin&#x2F;subl &#x2F;usr&#x2F;bin&#x2F;subl</span><br><span class="line">subl workspace&#x2F;medweb 会直接打开medweb工程，很方便</span><br></pre></td></tr></table></figure>

<h2 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h2><blockquote>
<p>建议直接传github 这样之后换电脑或者离职之后就很方便了。</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/06/zabbix%E8%BF%81%E7%A7%BB%E5%88%B0open-falcon/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/06/zabbix%E8%BF%81%E7%A7%BB%E5%88%B0open-falcon/" class="post-title-link" itemprop="url">zabbix迁移到open-falcon</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-06 17:53:38" itemprop="dateCreated datePublished" datetime="2017-06-06T17:53:38+08:00">2017-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E7%9B%91%E6%8E%A7/" itemprop="url" rel="index"><span itemprop="name">监控</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="falcon-介绍"><a href="#falcon-介绍" class="headerlink" title="falcon 介绍"></a>falcon 介绍</h1><blockquote>
<p>由于zabbix监控的可拓展性不是很高，业务的监控并不是很灵活，所以运维打算换成灵活度更好的open-falcon，他是小米公司推出的一款开源软件，基于go语言开发，安装比较方便。因为有着比较好看及灵活UI所以我们使用起来也是十分方便。但是社区相比zabbix小很多，坑也多一点，毕竟第一个吃螃蟹的人得付出点勇气。</p>
</blockquote>
<p><img src="http://or2jd66dq.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-06-06%20%E4%B8%8B%E5%8D%885.57.09.png" alt=""></p>
<h2 id="优点说明"><a href="#优点说明" class="headerlink" title="优点说明"></a>优点说明</h2><ul>
<li><p>水平扩展能力：支持每个周期上亿次的数据采集、告警判定、历史数据存储和查询</p>
</li>
<li><p>高效率的告警策略管理：高效的portal、支持策略模板、模板继承和覆盖、多种告警方式、支持callback调用</p>
</li>
<li><p>人性化的告警设置：最大告警次数、告警级别、告警恢复通知、告警暂停、不同时段不同阈值</p>
</li>
<li><p>高效率的graph组件：单机支撑200万metric的上报、归档、存储（周期为1分钟）</p>
</li>
<li><p>高效的历史数据query组件：采用rrdtool的数据归档策略，秒级返回上百个metric一年的历史数据</p>
</li>
<li><p>dashboard：多维度的数据展示，用户自定义Screen</p>
</li>
<li><p>高可用：整个系统无核心单点，易运维，易部署，可水平扩展</p>
</li>
<li><p>开发语言： 整个系统的后端，全部golang编写，portal和dashboard使用python编写。</p>
</li>
</ul>
<h2 id="组件介绍"><a href="#组件介绍" class="headerlink" title="组件介绍"></a>组件介绍</h2><h3 id="agent-组件"><a href="#agent-组件" class="headerlink" title="agent 组件"></a><strong>agent 组件</strong></h3><pre><code>* 监控客户端 相当于zabbix_agent 收集监控数据，提供接口供我们写脚本上传数据
* 支持自发现，默认自带很多基本监控，它的自定义监控指标通过HBS（HBS读取portal数据库）获得
* 每隔60秒push给Transfer。agent与Transfer建立了长连接，数据发送速度比较快，agent提供了一个http接口/v1/push用于接收用户手工push的一些数据，然后通过长连接迅速转发给Transfer。</code></pre><h3 id="Aggregater组件-集群聚合模块。（目前我们还没有应用）"><a href="#Aggregater组件-集群聚合模块。（目前我们还没有应用）" class="headerlink" title="Aggregater组件   集群聚合模块。（目前我们还没有应用）"></a><strong>Aggregater组件</strong>   集群聚合模块。（目前我们还没有应用）</h3><pre><code>* 聚合某集群下的所有机器的某个指标的值，比如所有机器的qps加和才是整个集群的qps，所有机器的request_fail数量 ÷ 所有机器的request_total数量=整个集群的请求失败率然后push回监控server端。</code></pre><h3 id="hbs（heartbeat-Server）组件"><a href="#hbs（heartbeat-Server）组件" class="headerlink" title="hbs（heartbeat Server）组件"></a><strong>hbs</strong>（heartbeat Server）组件</h3><pre><code>心跳服务器，公司所有agent都会连到HBS，每分钟发一次心跳请求。
agent发送心跳信息给HBS的时候，会把hostname、ip、agent version、plugin version等信息告诉HBS，HBS负责更新host表。 插入到portal数据库中</code></pre><h3 id="portal组件"><a href="#portal组件" class="headerlink" title="portal组件"></a><strong>portal组件</strong></h3><pre><code>Portal是用来配置报警策略的，策略存放于数据库中，通过hbs的读取传递到agent端</code></pre><h3 id="transfer组件"><a href="#transfer组件" class="headerlink" title="transfer组件"></a><strong>transfer组件</strong></h3><pre><code>transfer是数据转发服务。它接收agent上报的数据，然后按照哈希规则进行数据分片、并将分片后的数据分别push给graph&amp;judge等组件。</code></pre><h3 id="judge组件"><a href="#judge组件" class="headerlink" title="judge组件"></a><strong>judge组件</strong></h3><pre><code>Judge用于告警判断，agent将数据push给Transfer，Transfer不但会转发给Graph组件来绘图，还会转发给Judge用于判断是否触发告警。</code></pre><h3 id="alarm组件"><a href="#alarm组件" class="headerlink" title="alarm组件"></a><strong>alarm组件</strong></h3><pre><code>alarm模块是处理报警event的，judge产生的报警event写入redis，alarm从redis读取处理</code></pre><h3 id="graph组件"><a href="#graph组件" class="headerlink" title="graph组件"></a><strong>graph组件</strong></h3><pre><code>graph是存储绘图数据的组件。graph组件 接收transfer组件推送上来的监控数据，同时处理query组件的查询请求、返回绘图数据。</code></pre><h3 id="query组件"><a href="#query组件" class="headerlink" title="query组件"></a><strong>query组件</strong></h3><pre><code>提供统一的绘图数据查询入口。query组件接收查询请求，根据一致性哈希算法去相应的graph实例查询不同metric的数据，然后汇总拿到的数据，最后统一返回给用户。</code></pre><h3 id="dashboard组件"><a href="#dashboard组件" class="headerlink" title="dashboard组件"></a><strong>dashboard组件</strong></h3><pre><code>dashboard是面向用户的查询界面。在这里，用户可以看到push到graph中的所有数据，并查看其趋势图。</code></pre><h3 id="fe组件"><a href="#fe组件" class="headerlink" title="fe组件"></a><strong>fe组件</strong></h3><pre><code>导航界面</code></pre><h3 id="nodata组件"><a href="#nodata组件" class="headerlink" title="nodata组件"></a><strong>nodata组件</strong></h3><pre><code>nodata用于检测监控数据的上报异常。nodata和实时报警judge模块协同工作，过程为: 配置了nodata的采集项超时未上报数据，nodata生成一条默认的模拟数据；用户配置相应的报警策略，收到mock数据就产生报警。采集项上报异常检测，作为judge模块的一个必要补充，能够使judge的实时报警功能更加可靠、完善</code></pre><h3 id="task组件"><a href="#task组件" class="headerlink" title="task组件"></a><strong>task组件</strong></h3><pre><code>task是监控系统一个必要的辅助模块。定时任务，实现了如下几个功能：
index更新。包括图表索引的全量更新 和 垃圾索引清理。
falcon服务组件的自身状态数据采集。定时任务了采集了transfer、graph、task这三个服务的内部状态数据。
falcon自检控任务。</code></pre><h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><blockquote>
<p>部署使用的二进制包部署，方便快捷，agent使用ansible安装到所有机器上，设置systemctl启动。其他组件包括redis安装到运维机器上。</p>
</blockquote>
<p>参照官网的部署<br>这里略过</p>
<h1 id="数据采集"><a href="#数据采集" class="headerlink" title="数据采集"></a>数据采集</h1><blockquote>
<p>falcon 数据采集分为以下三种方式</p>
</blockquote>
<ul>
<li>=基础库= 业务代码加载基础库、服务实例在运行过程中主动采集并push相关数据到agent</li>
<li>=nginx_lua_module= 嵌在nginx中主动采集业务相关指标 如状态码次数，QPS，服务可用度等</li>
<li>=自定义数据采集=  自己通过脚本push到agent，查看<a href="https://git.chunyu.me/op/op_tools/blob/master/op_tools/falcon.py">https://git.chunyu.me/op/op_tools/blob/master/op_tools/falcon.py</a> 这个很灵活 可以采集很多东西</li>
</ul>
<h2 id="数据模型"><a href="#数据模型" class="headerlink" title="数据模型"></a>数据模型</h2><p><img src="http://or2jd66dq.bkt.clouddn.com/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202017-06-09%20%E4%B8%8B%E5%8D%886.27.47.png" alt=""></p>
<ul>
<li>metric: <ul>
<li>最核心的字段，代表这个数据采集项具体度量的是什么东西，比如内存的使用量、某个接口的调用次数</li>
</ul>
</li>
<li>endpoint: <ul>
<li>监控实体，代表metric的主体，比如metric是内存使用量，那么endpoint就表示该metric属于哪台机器，也可以表示某个业务比如medweb，其实endpoint是一个特殊的tag。</li>
</ul>
</li>
<li>tags: <ul>
<li>这是一组逗号分隔的键值对，用来对metric进行进一步的描述，比如service=falcon,location=beijing</li>
</ul>
</li>
<li>timestamp: <ul>
<li>UNIX时间戳，表示产生该数据的时间</li>
</ul>
</li>
<li>value: <ul>
<li>整型或者浮点型，代表该metric在指定时间点的取值</li>
</ul>
</li>
<li>step: <ul>
<li>整型，表示该数据采集项的汇报周期，这对于后续的监控策略配置、图表展示很重要，必须明确指定</li>
</ul>
</li>
<li>counterType: <ul>
<li>只能是COUNTER或者GAUGE二选一，前者表示该采集项为计数器类型，后者表示其为原值；对于计数器类型，告警判定以及图表展示前，会被先计算为速率</li>
</ul>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/06/Mac%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/06/Mac%E8%BD%AF%E4%BB%B6%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">Mac软件使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-06 17:48:15" itemprop="dateCreated datePublished" datetime="2017-06-06T17:48:15+08:00">2017-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p><a href="http://xclient.info/">推荐下载链接-xclient</a><br><a href="http://www.ifunmac.com/">推荐下载链接-玩转苹果</a><br><a href="https://sspai.com/">少数派</a><br><a href="http://wangchujiang.com/awesome-mac/index.zh.html">awesome-mac</a></p>
<p>告别鼠标的效率神器: Alfred</p>
<p>编辑器: sublime, Pycharm, Atom</p>
<p>接口测试: charles, postman</p>
<p>json格式化: Textlab</p>
<p>脑图: Xmind </p>
<p>Markdown: 马克飞象, Mou </p>
<p>远程工具: teamviewer</p>
<p>VPN: Tunnalblik</p>
<p>科学上网: shadowsocksx</p>
<p>密码记录: 1password</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/06/lsof%E5%8D%81%E5%87%A0%E4%B8%AA%E5%AE%9E%E4%BE%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/06/lsof%E5%8D%81%E5%87%A0%E4%B8%AA%E5%AE%9E%E4%BE%8B/" class="post-title-link" itemprop="url">lsof十几个实例</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-06 16:36:41" itemprop="dateCreated datePublished" datetime="2017-06-06T16:36:41+08:00">2017-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">运维工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="lsof十几个示例"><a href="#lsof十几个示例" class="headerlink" title="lsof十几个示例"></a>lsof十几个示例</h1><hr>
<blockquote>
<p>lsof的意思是’列出打开的文件’，用于找出哪些文件被哪些进程打开或是占用。我们都知道Linux/UNIX的理念就是一切皆文件(包括pipes管道、sockets、directories目录、devices设备等等)。使用lsof命令的原因之一就是，当一个磁盘不能被卸载时，借助lsof这个命令我们可以轻易的识别哪些文件正在被占用.</p>
</blockquote>
<hr>
<p>[toc]</p>
<hr>
<h2 id="1-通过lsof命令列出所有打开的文件"><a href="#1-通过lsof命令列出所有打开的文件" class="headerlink" title="1.通过lsof命令列出所有打开的文件"></a>1.通过lsof命令列出所有打开的文件</h2><blockquote>
<p>在下面的例子中，它会以长列表的形式显示打开的文件，为了便于理解，它以Command、PID、USER、FD、TYPE分类</p>
</blockquote>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">(July) [<span class="type">root</span>@<span class="type">blog</span> <span class="type">local</span>]<span class="comment"># lsof</span></span><br><span class="line">COMMAND     PID   TID           USER   FD      TYPE             DEVICE  SIZE/OFF       NODE NAME</span><br><span class="line">systemd       <span class="number">1</span>                 root  cwd       DIR              <span class="number">253</span>,<span class="number">0</span>      <span class="number">4096</span>        <span class="number">128</span> /</span><br><span class="line">systemd       <span class="number">1</span>                 root  rtd       DIR              <span class="number">253</span>,<span class="number">0</span>      <span class="number">4096</span>        <span class="number">128</span> /</span><br><span class="line">systemd       <span class="number">1</span>                 root  txt       REG              <span class="number">253</span>,<span class="number">0</span>   <span class="number">1478168</span>     <span class="number">198856</span> /usr/lib/systemd/systemd</span><br><span class="line">systemd       <span class="number">1</span>                 root  mem       REG              <span class="number">253</span>,<span class="number">0</span>     <span class="number">20032</span>   <span class="number">50421307</span> /usr/lib64/libuuid.so.<span class="number">1.3</span>.<span class="number">0</span></span><br><span class="line">systemd       <span class="number">1</span>                 root  mem       REG              <span class="number">253</span>,<span class="number">0</span>    <span class="number">252704</span>   <span class="number">50886702</span> /usr/lib64/libblkid.so.<span class="number">1.1</span>.<span class="number">0</span></span><br><span class="line">systemd       <span class="number">1</span>                 root  mem       REG              <span class="number">253</span>,<span class="number">0</span>     <span class="number">90664</span>   <span class="number">50421293</span> /usr/lib64/libz.so.<span class="number">1.2</span>.<span class="number">7</span></span><br><span class="line">systemd       <span class="number">1</span>                 root  mem       REG              <span class="number">253</span>,<span class="number">0</span>    <span class="number">157424</span>   <span class="number">50421256</span> /usr/lib64/liblzma.so.<span class="number">5.2</span>.<span class="number">2</span></span><br><span class="line">systemd       <span class="number">1</span>                 root  mem       REG              <span class="number">253</span>,<span class="number">0</span>     <span class="number">19888</span>   <span class="number">50421655</span> /usr/lib64/libattr.so.<span class="number">1.1</span>.<span class="number">0</span></span><br><span class="line">systemd       <span class="number">1</span>                 root  mem       REG              <span class="number">253</span>,<span class="number">0</span>     <span class="number">19776</span>   <span class="number">51932115</span> /usr/lib64/libdl<span class="literal">-2</span>.<span class="number">17</span>.so</span><br><span class="line">systemd       <span class="number">1</span>                 root  mem       REG              <span class="number">253</span>,<span class="number">0</span>    <span class="number">398264</span>   <span class="number">51548149</span> /usr/lib64/libpcre.so.<span class="number">1.2</span>.<span class="number">0</span></span><br><span class="line">systemd       <span class="number">1</span>                 root  mem       REG              <span class="number">253</span>,<span class="number">0</span>   <span class="number">2118128</span>   <span class="number">50333965</span> /usr/lib64/libc<span class="literal">-2</span>.<span class="number">17</span>.so</span><br></pre></td></tr></table></figure>
<p>若不指定条件默认将显示所有进程打开的所有文件,lsof输出各列信息的意义如下:</p>
<ul>
<li>COMMAND：进程的名称</li>
<li>PID：进程标识符</li>
<li>USER：进程所有者</li>
<li>FD：文件描述符，应用程序通过文件描述符识别该文件。如cwd、txt等<ul>
<li>cwd 表示应用程序的当前工作目录</li>
<li>RTD 根目录</li>
<li>txt txt类型文件是程序代码，应用程序二进制文件本身或共享库</li>
<li>MEM 内存映射文件</li>
<li>u 表示该文件被打开并处于读取/写入模式，而不是只读 ® 或只写 (w) 模式。</li>
<li>W 表示该应用程序具有对整个文件的写锁。该文件描述符用于确保每次只能打开一个应用程序实例。</li>
<li>R 读访问</li>
<li>初始打开每个应用程序时，都具有三个文件描述符，从 0 到 2，分别表示标准输入、输出和错误流。所以大多数应用程序所打开的文件的FD都是从3开始。</li>
</ul>
</li>
<li>TYPE：文件类型，如DIR、REG等<ul>
<li>DIR 目录</li>
<li>REG 基本文件</li>
<li>CHR 字符特殊文件</li>
<li>FIFO 先进先出</li>
<li>UNIX unix域套接字</li>
</ul>
</li>
<li>DEVICE：指定磁盘的名称</li>
<li>SIZE：文件的大小</li>
<li>NODE：索引节点（文件在磁盘上的标识）</li>
<li>NAME：打开文件的确切名称</li>
</ul>
<hr>
<h1 id="2-列出特定用户打开的文件"><a href="#2-列出特定用户打开的文件" class="headerlink" title="2.列出特定用户打开的文件"></a>2.列出特定用户打开的文件</h1><p>使用<strong>-u</strong>选项后接用户指定某个用户打开文件</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -u apache</span></span><br><span class="line">COMMAND  PID   USER   FD   TYPE DEVICE SIZE/OFF    NODE NAME</span><br><span class="line">httpd   <span class="number">6032</span> apache  cwd    DIR    <span class="number">8</span>,<span class="number">3</span>     <span class="number">4096</span>       <span class="number">2</span> /</span><br><span class="line">httpd   <span class="number">6032</span> apache  rtd    DIR    <span class="number">8</span>,<span class="number">3</span>     <span class="number">4096</span>       <span class="number">2</span> /</span><br><span class="line">httpd   <span class="number">6032</span> apache  txt    REG    <span class="number">8</span>,<span class="number">3</span>   <span class="number">354688</span> <span class="number">1605148</span> /usr/sbin/httpd</span><br><span class="line">httpd   <span class="number">6032</span> apache  mem    REG    <span class="number">8</span>,<span class="number">3</span>    <span class="number">65928</span>  <span class="number">654110</span> /lib64/libnss_files<span class="literal">-2</span>.<span class="number">12</span>.so</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="3-查找特定端口运行的进程"><a href="#3-查找特定端口运行的进程" class="headerlink" title="3.查找特定端口运行的进程"></a>3.查找特定端口运行的进程</h1><p>使用<strong>-i</strong>选项来查找正在运行特定端口的进程</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -i TCP:53</span></span><br><span class="line">COMMAND   PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">named   <span class="number">16885</span> named   <span class="number">20</span>u  IPv4  <span class="number">61664</span>      <span class="number">0</span>t0  TCP localhost:domain (LISTEN)</span><br><span class="line"><span class="comment"># lsof -i UDP:53</span></span><br><span class="line">COMMAND   PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">named   <span class="number">16885</span> named  <span class="number">512</span>u  IPv4  <span class="number">61663</span>      <span class="number">0</span>t0  UDP localhost:domain</span><br><span class="line"><span class="comment"># lsof -i:53</span></span><br><span class="line">named   <span class="number">16885</span> named   <span class="number">20</span>u  IPv4  <span class="number">61664</span>      <span class="number">0</span>t0  TCP localhost:domain (LISTEN)</span><br><span class="line">named   <span class="number">16885</span> named  <span class="number">512</span>u  IPv4  <span class="number">61663</span>      <span class="number">0</span>t0  UDP localhost:domain</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="4-列出ipv4-和ipv6的文件"><a href="#4-列出ipv4-和ipv6的文件" class="headerlink" title="4.列出ipv4 和ipv6的文件"></a>4.列出ipv4 和ipv6的文件</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"> <span class="comment">#lsof -i 4</span></span><br><span class="line">COMMAND    PID  USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">sshd      <span class="number">1239</span>  root    <span class="number">3</span>u  IPv4  <span class="number">10081</span>      <span class="number">0</span>t0  TCP *:ssh (LISTEN)</span><br><span class="line"><span class="comment"># lsof -i 6</span></span><br><span class="line">COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">sshd     <span class="number">1239</span>   root    <span class="number">4</span>u  IPv6  <span class="number">10083</span>      <span class="number">0</span>t0  TCP *:ssh (LISTEN)</span><br></pre></td></tr></table></figure>
<hr>
<p>#5.列出TCP端口范围1-1024端口</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -i TCP:1-1024</span></span><br><span class="line">COMMAND   PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">sshd     <span class="number">1239</span>   root    <span class="number">3</span>u  IPv4  <span class="number">10081</span>      <span class="number">0</span>t0  TCP *:ssh (LISTEN)</span><br><span class="line">sshd     <span class="number">1239</span>   root    <span class="number">4</span>u  IPv6  <span class="number">10083</span>      <span class="number">0</span>t0  TCP *:ssh (LISTEN)</span><br><span class="line">httpd    <span class="number">2142</span>   root    <span class="number">4</span>u  IPv6  <span class="number">13337</span>      <span class="number">0</span>t0  TCP *:http (LISTEN)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="6-通过脱字符排除某个用户"><a href="#6-通过脱字符排除某个用户" class="headerlink" title="6.通过脱字符排除某个用户"></a>6.通过脱字符排除某个用户</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># lsof -u^root</span></span><br><span class="line">COMMAND     PID   USER   FD   TYPE             DEVICE SIZE/OFF    NODE NAME</span><br><span class="line">dbus<span class="literal">-daem</span>  <span class="number">1212</span>   dbus  cwd    DIR                <span class="number">8</span>,<span class="number">3</span>     <span class="number">4096</span>       <span class="number">2</span> /</span><br><span class="line">dbus<span class="literal">-daem</span>  <span class="number">1212</span>   dbus  rtd    DIR                <span class="number">8</span>,<span class="number">3</span>     <span class="number">4096</span>       <span class="number">2</span> /</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="7-查找特定文件用户和命令"><a href="#7-查找特定文件用户和命令" class="headerlink" title="7.查找特定文件用户和命令"></a>7.查找特定文件用户和命令</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -i -u apache </span></span><br><span class="line">COMMAND    PID   USER   FD   TYPE DEVICE SIZE/OFF    NODE NAME</span><br><span class="line">httpd     <span class="number">6032</span> apache  txt    REG    <span class="number">8</span>,<span class="number">3</span>   <span class="number">354688</span> <span class="number">1605148</span> /usr/sbin/httpd</span><br><span class="line">httpd     <span class="number">6032</span> apache  mem    REG    <span class="number">8</span>,<span class="number">3</span>     <span class="number">9488</span>  <span class="number">271645</span> /usr/lib64/apr<span class="literal">-util</span><span class="literal">-1</span>/apr_ldap<span class="literal">-1</span>.so</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="8-查看所有的网络连接"><a href="#8-查看所有的网络连接" class="headerlink" title="8.查看所有的网络连接"></a>8.查看所有的网络连接</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -i</span></span><br><span class="line">COMMAND    PID   USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">sshd      <span class="number">1239</span>   root    <span class="number">3</span>u  IPv4  <span class="number">10081</span>      <span class="number">0</span>t0  TCP *:ssh (LISTEN)</span><br><span class="line">sshd      <span class="number">1239</span>   root    <span class="number">4</span>u  IPv6  <span class="number">10083</span>      <span class="number">0</span>t0  TCP *:ssh (LISTEN)</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="9-采用pid搜索"><a href="#9-采用pid搜索" class="headerlink" title="9.采用pid搜索"></a>9.采用pid搜索</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof -p 1</span></span><br><span class="line">COMMAND PID USER   FD   TYPE             DEVICE SIZE/OFF   NODE NAME</span><br><span class="line">init      <span class="number">1</span> root  cwd    DIR                <span class="number">8</span>,<span class="number">3</span>     <span class="number">4096</span>      <span class="number">2</span> /</span><br><span class="line">init      <span class="number">1</span> root  rtd    DIR                <span class="number">8</span>,<span class="number">3</span>     <span class="number">4096</span>      <span class="number">2</span> /</span><br><span class="line">init      <span class="number">1</span> root  txt    REG                <span class="number">8</span>,<span class="number">3</span>   <span class="number">150352</span> <span class="number">527181</span> /sbin/init</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="10-杀死某个特定用户的所有活动"><a href="#10-杀死某个特定用户的所有活动" class="headerlink" title="10.杀死某个特定用户的所有活动"></a>10.杀死某个特定用户的所有活动</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># kill -9 `lsof -t -u named`</span></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="11-查看谁在使用文件系统-在卸载文件系统时"><a href="#11-查看谁在使用文件系统-在卸载文件系统时" class="headerlink" title="11.查看谁在使用文件系统,在卸载文件系统时"></a>11.查看谁在使用文件系统,在卸载文件系统时</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof /mnt/</span></span><br><span class="line">COMMAND   PID USER   FD   TYPE DEVICE SIZE/OFF NODE NAME</span><br><span class="line">bash    <span class="number">16672</span> root  cwd    DIR   <span class="number">11</span>,<span class="number">0</span>     <span class="number">8192</span> <span class="number">1856</span> /mnt</span><br><span class="line">lsof    <span class="number">17041</span> root  cwd    DIR   <span class="number">11</span>,<span class="number">0</span>     <span class="number">8192</span> <span class="number">1856</span> /mnt</span><br><span class="line">lsof    <span class="number">17042</span> root  cwd    DIR   <span class="number">11</span>,<span class="number">0</span>     <span class="number">8192</span> <span class="number">1856</span> /mnt</span><br></pre></td></tr></table></figure>
<hr>
<h1 id="12-查看被删除的文件"><a href="#12-查看被删除的文件" class="headerlink" title="12.查看被删除的文件"></a>12.查看被删除的文件</h1><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof | grep deleted --color</span></span><br><span class="line">console<span class="literal">-k</span>  <span class="number">1291</span>   root  txt       REG                <span class="number">8</span>,<span class="number">3</span>   <span class="number">155008</span>    <span class="number">1577669</span> /usr/sbin/console<span class="literal">-kit</span><span class="literal">-daemon</span>.<span class="comment">#prelink#.bXthE2 (deleted)</span></span><br><span class="line">tail      <span class="number">17553</span>   root    <span class="number">3</span>r      REG                <span class="number">8</span>,<span class="number">3</span>        <span class="number">6</span>     <span class="number">523317</span> /tmp/test2 (deleted)</span><br></pre></td></tr></table></figure>

<h1 id="13-恢复误删除文件"><a href="#13-恢复误删除文件" class="headerlink" title="13.恢复误删除文件"></a>13.恢复误删除文件</h1><blockquote>
<p>当Linux计算机受到入侵时，常见的情况是日志文件被删除，以掩盖攻击者的踪迹。管理错误也可能导致意外删除重要的文件，比如在清理旧日志时，意外地删除了数据库的活动事务日志。有时可以通过lsof来恢复这些文件。</p>
</blockquote>
<blockquote>
<p>当进程打开了某个文件时，只要该进程保持打开该文件，即使将其删除，它依然存在于磁盘中。这意味着，进程并不知道文件已经被删除，它仍然可以向打开该文件时提供给它的文件描述符进行读取和写入。除了该进程之外，这个文件是不可见的，因为已经删除了其相应的目录索引节点。<br>在/proc 目录下，其中包含了反映内核和进程树的各种文件。/proc目录挂载的是在内存中所映射的一块区域，所以这些文件和目录并不存在于磁盘中，因此当我们对这些文件进行读取和写入时，实际上是在从内存中获取相关信息。大多数与 lsof 相关的信息都存储于以进程的 PID 命名的目录中，即/proc/1234 中包含的是PID为1234 的进程的信息。</p>
</blockquote>
<p>当系统中的某个文件被意外地删除了，只要这个时候系统中还有进程正在访问该文件，那么我们就可以通过lsof从/proc目录下恢复该文件的内容。 假如由于误操作将/var/log/messages文件删除掉了，那么这时要将/var/log/messages文件恢复的方法如下：</p>
<ul>
<li><p>首先使用lsof来查看当前是否有进程打开/var/logmessages文件，如下:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># lsof |grep /var/log/messages</span></span><br><span class="line">syslogd   <span class="number">1283</span>      root    <span class="number">2</span>w      REG        <span class="number">3</span>,<span class="number">3</span>  <span class="number">5381017</span>    <span class="number">1773647</span> /var/log/messages (deleted)</span><br></pre></td></tr></table></figure></li>
<li><p>从上面的信息可以看到 PID 1283（syslogd）打开文件的文件描述符为 2。同时还可以看到/var/log/messages已经标记被删除了。因此我们可以在 /proc/1283/fd/2 （fd下的每个以数字命名的文件表示进程对应的文件描述符）中查看相应的信息，如下：</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># head -n 10 /proc/1283/fd/2</span></span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 syslogd <span class="number">1.4</span>.<span class="number">1</span>: restart.</span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 kernel: klogd <span class="number">1.4</span>.<span class="number">1</span>, log source = /proc/kmsg started.</span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 kernel: Linux version <span class="number">2.6</span>.<span class="number">22.1</span><span class="literal">-8</span> (root@everestbuilder.linux<span class="literal">-ren</span>.org) (gcc version <span class="number">4.2</span>.<span class="number">0</span>) <span class="comment">#1 SMP Wed Jul 18 11:18:32 EDT 2007</span></span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 kernel: BIOS<span class="literal">-provided</span> physical RAM map:</span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 kernel:  BIOS<span class="literal">-e820</span>: <span class="number">0000000000000000</span> - <span class="number">000000000009</span>f000 (usable)</span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 kernel:  BIOS<span class="literal">-e820</span>: <span class="number">000000000009</span>f000 - <span class="number">00000000000</span>a0000 (reserved)</span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 kernel:  BIOS<span class="literal">-e820</span>: <span class="number">0000000000100000</span> - <span class="number">000000001</span>f7d3800 (usable)</span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 kernel:  BIOS<span class="literal">-e820</span>: <span class="number">000000001</span>f7d3800 - <span class="number">0000000020000000</span> (reserved)</span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 kernel:  BIOS<span class="literal">-e820</span>: <span class="number">00000000</span>e0000000 - <span class="number">00000000</span>f0007000 (reserved)</span><br><span class="line">Aug  <span class="number">4</span> <span class="number">13</span>:<span class="number">50</span>:<span class="number">15</span> holmes86 kernel:  BIOS<span class="literal">-e820</span>: <span class="number">00000000</span>f0008000 - <span class="number">00000000</span>f000c000 (reserved)</span><br></pre></td></tr></table></figure>
</li>
<li><p>从上面的信息可以看出，查看 /proc/1283/fd/2 就可以得到所要恢复的数据。如果可以通过文件描述符查看相应的数据，那么就可以使用 I/O 重定向将其复制到文件中，如:</p>
<figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cat /proc/<span class="number">1283</span>/fd/<span class="number">2</span> &gt; /var/log/messages</span><br></pre></td></tr></table></figure>
</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2017/06/06/file-beat%E6%8E%A5%E5%85%A5ELK/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2017/06/06/file-beat%E6%8E%A5%E5%85%A5ELK/" class="post-title-link" itemprop="url">file_beat接入ELK</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2017-06-06 15:56:13" itemprop="dateCreated datePublished" datetime="2017-06-06T15:56:13+08:00">2017-06-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E8%BF%90%E7%BB%B4%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">运维工具</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>公司之前的日志收集使用的kids(知乎开源的日志收集工具，不知道为啥用这个，难道是因为跟我们你是邻居？)。然后统一收留存到一台机器，做中转留几天的方便大家查看，后续直接存到Hadoop中。后来搭建ELK就是直接在这个机器上起的logstash，说白了只是把这几天的日志做了可视化。但是现在我们有了另一种需求，需要收集各个机器的系统日志，加上之前做了bash_history 也需要收集。但是我并不是很想用kids,它改配置重启都比较麻烦。也不太想用整个的logstash，太大了，正好filebeat可以满足我们的需求，很轻而且使用go开发。<br>但是还是有一个想法，之前的ELK 有的时候会出现数据延时很大的情况，我分析是ES集群的压力过大，所以我想在ES之前加一个缓冲，加一个kafka队列<br>这正好是一个实验的机会。</p>
</blockquote>
<p>之前架构：<br><img src="http://or2jd66dq.bkt.clouddn.com/ELK%E6%97%A9%E6%9C%9F%E6%9E%B6%E6%9E%84.png" alt=""></p>
<p>架构调整如下：</p>
<p><img src="http://or2jd66dq.bkt.clouddn.com/ELK-kafka.png" alt=""></p>
<p>参考:<a href="https://www.ibm.com/developerworks/cn/opensource/os-cn-elk-filebeat/index.html">https://www.ibm.com/developerworks/cn/opensource/os-cn-elk-filebeat/index.html</a></p>
<h2 id="版本介绍"><a href="#版本介绍" class="headerlink" title="版本介绍"></a>版本介绍</h2><ul>
<li>logstash 2.3.2</li>
<li>Elasticsearch 2.3.2</li>
<li>kafka 0.10.0.2</li>
<li>filebeat 5.0.0</li>
<li>kibana 4.3.1<br>由于ELKstack 各个组件之前有很强的版本依赖，所以安装之前最好确认下。据说filebeat5.0 logstash也得使用5.0,ES 也得使用5.0 但是我们使filebeat 和logstash之间加了一个kafka队列，就给这两个组件直接解耦了。filebeat5.0之后才能直接output到kafka。logstash2.3可以直接使用kafka 作为input。正好。。。</li>
</ul>
<h1 id="kafka安装"><a href="#kafka安装" class="headerlink" title="kafka安装"></a>kafka安装</h1><blockquote>
<p>最新版本0.10.0.2<br>java 1.8</p>
</blockquote>
<p>部署参考: <a href="https://www.mtyun.com/library/32/how-to-install-kafka-on-centos7/">https://www.mtyun.com/library/32/how-to-install-kafka-on-centos7/</a><br>kafka配置参考: <a href="http://www.cnblogs.com/davidwang456/p/4195873.html">http://www.cnblogs.com/davidwang456/p/4195873.html</a></p>
<p><code>Broker</code><br>Kafka集群包含一个或多个服务器，这种服务器被称为broker</p>
<p><code>Topic</code><br>每条发布到Kafka集群的消息都有一个类别，这个类别被称为Topic。（物理上不同Topic的消息分开存储，逻辑上一个Topic的消息虽然保存于一个或多个broker上但用户只需指定消息的Topic即可生产或消费数据而不必关心数据存于何处）</p>
<p><code>Partition</code><br>Parition是物理上的概念，每个Topic包含一个或多个Partition.<br>很像ES的分片概念，合理设置可以提高效率</p>
<p><code>Producer</code><br>负责发布消息到Kafka broker</p>
<p><code>Consumer</code><br>消息消费者，向Kafka broker读取消息的客户端。</p>
<p><code>Consumer Group</code><br>每个Consumer属于一个特定的Consumer Group（可为每个Consumer指定group name，若不指定group name则属于默认的group）。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">wget http:&#x2F;&#x2F;mirror.bit.edu.cn&#x2F;apache&#x2F;kafka&#x2F;0.10.2.1&#x2F;kafka_2.10-0.10.2.1.tgz</span><br><span class="line">tar -zxvf kafka_2.10-0.10.2.1.tgz</span><br><span class="line"></span><br><span class="line"># 启动zookeeper </span><br><span class="line">bin&#x2F;zookeeper-server-start.sh -daemon config&#x2F;zookeeper.properties</span><br><span class="line"># 启动kafka</span><br><span class="line">bin&#x2F;kafka-server-start.sh config&#x2F;server.properties &amp;</span><br><span class="line"># 功能验证</span><br><span class="line">## 新建一个topic </span><br><span class="line">bin&#x2F;kafka-topics.sh --create --zookeeper localhost:2181 --replication-factor 1 --partitions 1 --topic test</span><br><span class="line">## 查看topic </span><br><span class="line">bin&#x2F;kafka-topics.sh --list --zookeeper localhost:2181</span><br><span class="line">## 手动产生消息</span><br><span class="line">bin&#x2F;kafka-console-producer.sh --broker-list localhost:9092 --topic test </span><br><span class="line">Hello Kafka！</span><br><span class="line">nihao shijie</span><br><span class="line">## 消费消息</span><br><span class="line">bin&#x2F;kafka-console-consumer.sh --zookeeper localhost:2181 --topic test --from-beginning</span><br><span class="line">Hello world!</span><br><span class="line">nihao shijie</span><br></pre></td></tr></table></figure>

<h2 id="单机多实例配置"><a href="#单机多实例配置" class="headerlink" title="单机多实例配置"></a>单机多实例配置</h2><blockquote>
<p>由于kafka 使用的是机器的文件系统存储，所以本机多实例的集群很好。尽量减少网络通讯。</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cp config&#x2F;server.properties config&#x2F;server_1.properties</span><br><span class="line"># 修改配置文件 </span><br><span class="line">vim config&#x2F;server_1.properties</span><br><span class="line">    broker.id&#x3D;1</span><br><span class="line">    port&#x3D;9093</span><br><span class="line">    log.dirs&#x3D;&#x2F;tmp&#x2F;kafka_1-logs</span><br><span class="line"># 启动</span><br><span class="line">bin&#x2F;kafka-server-start.sh config&#x2F;server_1.properties &amp;</span><br></pre></td></tr></table></figure>

<h2 id="机器调优"><a href="#机器调优" class="headerlink" title="机器调优"></a>机器调优</h2><p>File descriptors</p>
<p>kafka会使用大量文件和网络socket，所以，我们需要把file descriptors的默认配置改为100000。修改方法如下(之前机器初始化的时候做过响应更改，可以忽略)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#vi &#x2F;etc&#x2F;sysctl.conf</span><br><span class="line"></span><br><span class="line">fs.file-max &#x3D; 32000</span><br><span class="line"></span><br><span class="line">#vi &#x2F;etc&#x2F;security&#x2F;limits.conf</span><br><span class="line"></span><br><span class="line">yourusersoftnofile10000</span><br><span class="line"></span><br><span class="line">youruserhardnofile30000</span><br></pre></td></tr></table></figure>


<h1 id="filebeat5-安装"><a href="#filebeat5-安装" class="headerlink" title="filebeat5 安装"></a>filebeat5 安装</h1><blockquote>
<p>版本5.0.0</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">curl -L -O https:&#x2F;&#x2F;artifacts.elastic.co&#x2F;downloads&#x2F;beats&#x2F;filebeat&#x2F;filebeat-5.0.0-x86_64.rpm</span><br><span class="line">rpm -ivh filebeat-5.0.0-x86_64.rpm</span><br></pre></td></tr></table></figure>
<p>配置</p>
<p><a href="https://www.elastic.co/guide/en/beats/filebeat/5.0/configuration-filebeat-options.html">官网配置参考</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">filebeat.prospectors:</span><br><span class="line">- input_type: log</span><br><span class="line">  paths:</span><br><span class="line">    - &#x2F;var&#x2F;log&#x2F;bash_history.log*</span><br><span class="line">  fields:</span><br><span class="line">    log_source: bash_history</span><br><span class="line">  document_type: bash_history</span><br><span class="line">  scan_frequency: 1s</span><br><span class="line">  ignore_older: 30m</span><br><span class="line"></span><br><span class="line">- input_type: log</span><br><span class="line">  paths:</span><br><span class="line">    - &#x2F;var&#x2F;log&#x2F;messages*</span><br><span class="line">  fields:</span><br><span class="line">    log_source: message</span><br><span class="line">  document_type: message</span><br><span class="line">  scan_frequency: 1s</span><br><span class="line">  ignore_older: 30m</span><br><span class="line">- input_type: log</span><br><span class="line">  paths:</span><br><span class="line">    - &#x2F;var&#x2F;log&#x2F;cron</span><br><span class="line">  fields:</span><br><span class="line">    log_source: cron</span><br><span class="line">  document_type: cron</span><br><span class="line">  scan_frequency: 1s</span><br><span class="line">  ignore_older: 30m</span><br><span class="line">- input_type: log</span><br><span class="line">  paths:</span><br><span class="line">    - &#x2F;var&#x2F;log&#x2F;secure</span><br><span class="line">  fields:</span><br><span class="line">    log_source: secure</span><br><span class="line">  document_type: secure</span><br><span class="line">  scan_frequency: 1s</span><br><span class="line">  ignore_older: 30m</span><br><span class="line">output.kafka:</span><br><span class="line">  hosts: [&quot;localhost:9092&quot;, &quot;localhost:9093&quot;]</span><br><span class="line">  topic: &#39;%&#123;[type]&#125;&#39;</span><br><span class="line">  partition.round_robin:</span><br><span class="line">    reachable_only: false</span><br><span class="line">  required_acks: 1</span><br><span class="line">  compression: gzip</span><br><span class="line">  max_message_bytes: 1000000</span><br></pre></td></tr></table></figure>

<h1 id="logstash-配置"><a href="#logstash-配置" class="headerlink" title="logstash 配置"></a>logstash 配置</h1><blockquote>
<p>logstash 是把数据从kafka中拿过来，放到ES中配置如下</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">input &#123;</span><br><span class="line">  kafka &#123;</span><br><span class="line">    zk_connect &#x3D;&gt; &quot;localhost:2181&quot;</span><br><span class="line">    topic_id &#x3D;&gt; &quot;sys_log&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">output &#123;</span><br><span class="line"></span><br><span class="line">    elasticsearch &#123;</span><br><span class="line">        hosts &#x3D;&gt; [&quot;10.215.33.36:9200&quot;]</span><br><span class="line">        manage_template &#x3D;&gt; true</span><br><span class="line">        index &#x3D;&gt; &quot;syslog-%&#123;+YYYY.MM.dd&#125;&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>




      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="fanquqi.github.io/page/6/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="fanquqi.github.io/">1</a><span class="space">&hellip;</span><a class="page-number" href="fanquqi.github.io/page/6/">6</a><span class="page-number current">7</span><a class="page-number" href="fanquqi.github.io/page/8/">8</a><a class="extend next" rel="next" href="fanquqi.github.io/page/8/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">fanquqi</p>
  <div class="site-description" itemprop="description">Raise my flag to the new age.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="fanquqi.github.io/archives/">
        
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fanquqi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="fanquqi.github.io/lib/anime.min.js"></script>
  <script src="fanquqi.github.io/lib/velocity/velocity.min.js"></script>
  <script src="fanquqi.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="fanquqi.github.io/js/utils.js"></script>

<script src="fanquqi.github.io/js/motion.js"></script>


<script src="fanquqi.github.io/js/schemes/muse.js"></script>


<script src="fanquqi.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
