<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="fanquqi.github.io/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="fanquqi.github.io/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="fanquqi.github.io/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="fanquqi.github.io/images/logo.svg" color="#222">

<link rel="stylesheet" href="fanquqi.github.io/css/main.css">


<link rel="stylesheet" href="fanquqi.github.io/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"fanquqi.github.io","root":"fanquqi.github.io/","scheme":"Muse","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Raise my flag to the new age.">
<meta property="og:type" content="website">
<meta property="og:title" content="fix u dream">
<meta property="og:url" content="https://fanquqi.github.io/index.html">
<meta property="og:site_name" content="fix u dream">
<meta property="og:description" content="Raise my flag to the new age.">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="fanquqi">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://fanquqi.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>fix u dream</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="fanquqi.github.io/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">fix u dream</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="fanquqi.github.io/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="fanquqi.github.io/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2020/05/21/2020-03-25/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2020/05/21/2020-03-25/" class="post-title-link" itemprop="url">2020-03-25</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-21 20:56:03" itemprop="dateCreated datePublished" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ceph-简介以日常运维问题"><a href="#ceph-简介以日常运维问题" class="headerlink" title="ceph 简介以日常运维问题"></a>ceph 简介以日常运维问题</h1><blockquote>
<p>Ceph是一个统一的分布式存储系统，设计初衷是提供较好的性能、可靠性和可扩展性</p>
</blockquote>
<h2 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h2><p><img src="/media/15851166353660.jpg" alt=""></p>
<p>自下向上，可以将Ceph系统分为四个层次：</p>
<ul>
<li>基础存储系统RADOS（Reliable, Autonomic, Distributed Object Store，即可靠的、自动化的、分布式的对象存储）ceph一切都以对象形式存储，是ceph的基础</li>
<li>基础库LIBRADOS</li>
<li>高层应用接口：包括了三个部分：RADOS GW（RADOS Gateway）、 RBD（Reliable Block Device）和Ceph FS（Ceph File System）</li>
<li>应用层</li>
</ul>
<h3 id="组件介绍"><a href="#组件介绍" class="headerlink" title="组件介绍"></a>组件介绍</h3><ul>
<li><strong>OSD （ Object Storage Device）</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实际存储数据的进程。通常一个OSD daemon绑定一个物理磁盘。Client write&#x2F;read 数据最终都会走到OSD去执行write&#x2F;read操作。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Monitor</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">负责监控整个集群健康状态</span><br><span class="line">OSD和monitor之间相互传输节点状态信息，共同得出系统的总体工作状态，并形成一个全局系统状态记录数据结构，即cluster map（monmap osdmap  pgmap等）。这个数据结构与RADOS提供的特定算法相配合，便实现了Ceph“无需查表，算算就好”的核心机制以及若干优秀特性</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Object</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Ceph最底层的存储单元是Object对象，每个Object包含元数据和原始数据。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>PG</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">PG全称Placement Grouops，是一个逻辑的概念，引入PG这一层其实是为了更好的分配数据和定位数据。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>Libradio</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Rados提供库，因为RADOS是协议很难直接访问，因此上层的RBD、RGW和CephFS都是通过librados访问的</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>CRUSH</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CRUSH是Ceph使用的数据分布算法，类似一致性哈希，让数据分配到预期的地方。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>RBD</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RBD全称RADOS block device，是Ceph对外提供的块设备服务。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>RGW</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">RGW全称RADOS gateway，是Ceph对外提供的对象存储服务，接口与S3和Swift兼容。</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>MDS</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MDS全称Ceph Metadata Server，是CephFS服务依赖的元数据服务。</span><br></pre></td></tr></table></figure>

<h2 id="io流程"><a href="#io流程" class="headerlink" title="io流程"></a>io流程</h2><p><img src="/media/15851170190174.jpg" alt=""></p>
<ol>
<li>client 创建cluster handler。</li>
<li>client 读取配置文件。 client 连接上monitor，获取集群map信息。 </li>
<li>client 读写io 根据crshmap 算法请求对应的主osd数据节点。</li>
<li>主osd数据节点同时写入另外两个副本节点数据。 </li>
<li>主节点及副本节点写入状态都成功后，返回给client，io写入完成。</li>
</ol>
<h2 id="io算法流程"><a href="#io算法流程" class="headerlink" title="io算法流程"></a>io算法流程</h2><p><img src="/media/15851171556375.jpg" alt=""></p>
<ol>
<li>File用户需要读写的文件。File-&gt;Object映射：</li>
</ol>
<p>a. ino (File的元数据，File的唯一id ,rbd即为block_name_prefix)。<br>b. ono(File切分产生的某个object的累加的序号，默认以4M切分一个块大小)。<br>c. oid(object id: ino + ono)。</p>
<ol start="2">
<li>Ceph指定一个静态hash函数计算oid的值，得到pgid。Object-&gt;PG映射：</li>
</ol>
<p>a. hash(oid) &amp; mask-&gt; pgid 。<br>b. mask = PG总数m(m为2的整数幂)-1 。</p>
<ol start="3">
<li>PG(Placement Group),用途是对object的存储进行组织和位置映射, 采用CRUSH算法，将pgid代入其中，然后得到一组OSD。PG-&gt;OSD映射：</li>
</ol>
<p>a. CRUSH(pgid)-&gt;(osd1,osd2,osd3) 。</p>
<p>rbd io类似</p>
<h2 id="日常运维问题"><a href="#日常运维问题" class="headerlink" title="日常运维问题"></a>日常运维问题</h2><h3 id="磁盘损坏（osd下线）"><a href="#磁盘损坏（osd下线）" class="headerlink" title="磁盘损坏（osd下线）"></a>磁盘损坏（osd下线）</h3><p>osd 自动摘掉</p>
<p>参考下线流程</p>
<p><strong>osd下线</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"># 备份crush map</span><br><span class="line">ceph osd getcrushmap -o crushmap-17:26  </span><br><span class="line"># 权重改为0</span><br><span class="line">ceph osd crush reweight osd.570 0 </span><br><span class="line">ceph osd tree|grep down</span><br><span class="line">ceph -s</span><br><span class="line"># 下线osd</span><br><span class="line">ceph osd crush remove osd.570 </span><br><span class="line">ceph -s</span><br><span class="line">ceph osd tree</span><br><span class="line"># 删除对应osd</span><br><span class="line">ceph osd rm osd.570</span><br></pre></td></tr></table></figure>

<h3 id="monitor-节点迁移"><a href="#monitor-节点迁移" class="headerlink" title="monitor 节点迁移"></a>monitor 节点迁移</h3><h3 id="集群扩容缩容"><a href="#集群扩容缩容" class="headerlink" title="集群扩容缩容"></a>集群扩容缩容</h3><h3 id="日常割接"><a href="#日常割接" class="headerlink" title="日常割接"></a>日常割接</h3><p>手动更改集群故障域</p>
<h3 id="新集群上线"><a href="#新集群上线" class="headerlink" title="新集群上线"></a>新集群上线</h3><h2 id="测试流程"><a href="#测试流程" class="headerlink" title="测试流程"></a>测试流程</h2><p><strong>性能测试</strong></p>
<p>集群:</p>
<pre><code>顺序读写
    - 带宽
    - iops
    - latency
随机读写
    - 带宽
    - iops
    - latency
混合读写
    - 带宽
    - iops
    - latency</code></pre><p>单盘:</p>
<pre><code>顺序读写
    - 带宽
    - iops
    - latency
随机读写
    - 带宽
    - iops
    - latency
混合读写
    - 带宽
    - iops
    - latency</code></pre><p> <strong>稳定性测试</strong></p>
<p>模拟线上故障等</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2020/05/21/hello-world/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2020/05/21/hello-world/" class="post-title-link" itemprop="url">Hello World</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-21 17:01:28" itemprop="dateCreated datePublished" datetime="2020-05-21T17:01:28+08:00">2020-05-21</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>Welcome to <a href="https://hexo.io/">Hexo</a>! This is your very first post. Check <a href="https://hexo.io/docs/">documentation</a> for more info. If you get any problems when using Hexo, you can find the answer in <a href="https://hexo.io/docs/troubleshooting.html">troubleshooting</a> or you can ask me on <a href="https://github.com/hexojs/hexo/issues">GitHub</a>.</p>
<h2 id="Quick-Start"><a href="#Quick-Start" class="headerlink" title="Quick Start"></a>Quick Start</h2><h3 id="Create-a-new-post"><a href="#Create-a-new-post" class="headerlink" title="Create a new post"></a>Create a new post</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo new <span class="string">"My New Post"</span></span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/writing.html">Writing</a></p>
<h3 id="Run-server"><a href="#Run-server" class="headerlink" title="Run server"></a>Run server</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo server</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/server.html">Server</a></p>
<h3 id="Generate-static-files"><a href="#Generate-static-files" class="headerlink" title="Generate static files"></a>Generate static files</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo generate</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/generating.html">Generating</a></p>
<h3 id="Deploy-to-remote-sites"><a href="#Deploy-to-remote-sites" class="headerlink" title="Deploy to remote sites"></a>Deploy to remote sites</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure>

<p>More info: <a href="https://hexo.io/docs/one-command-deployment.html">Deployment</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2019/11/28/linux%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2019/11/28/linux%E7%B3%BB%E7%BB%9F%E7%9F%A5%E8%AF%86/" class="post-title-link" itemprop="url">linux系统知识</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-11-28 10:58:17" itemprop="dateCreated datePublished" datetime="2019-11-28T10:58:17+08:00">2019-11-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2019/10/12/flume%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E8%B7%AF-1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2019/10/12/flume%E5%AE%B9%E5%99%A8%E5%8C%96%E4%B9%8B%E8%B7%AF-1/" class="post-title-link" itemprop="url">flume容器化之路</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-10-12 19:10:27" itemprop="dateCreated datePublished" datetime="2019-10-12T19:10:27+08:00">2019-10-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:03" itemprop="dateModified" datetime="2020-05-21T20:56:03+08:00">2020-05-21</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="fanquqi.github.io/categories/%E5%AE%B9%E5%99%A8/" itemprop="url" rel="index"><span itemprop="name">容器</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>今天主要讲下 qbus 落地到hdfs的组件–flume,的容器化过程，希望能给在座的有把服务迁移到容器的各位，提供一个解决方案，可能不是最好，但是它很真实。</p>
<hr>
<blockquote>
<p>flume 在qbus 服务中作用：</p>
</blockquote>
<pre><code>消费各个业务的topic数据，持久化到hdfs。</code></pre><h2 id="hulk流程"><a href="#hulk流程" class="headerlink" title="hulk流程"></a>hulk流程</h2><ul>
<li>user 通过 <strong>hulk</strong> 开通落地到hdfs服务，hulk脚本把相关配置存在zookeeper中。</li>
</ul>
<p><img src="/media/15737081010383.jpg" alt=""></p>
<ul>
<li>本地脚本cron遍历读取zk配置（每个机器消费集群维护一个cluster_list）</li>
</ul>
<p><img src="/media/15737082330569.jpg" alt=""></p>
<ul>
<li>机器本地起flume进程消费，写hdfs。</li>
</ul>
<h2 id="服务痛点"><a href="#服务痛点" class="headerlink" title="服务痛点:"></a>服务痛点:</h2><h3 id="可用性"><a href="#可用性" class="headerlink" title="可用性"></a>可用性</h3><ul>
<li>hdfs集群割接断网</li>
<li>flume机器down机</li>
<li>某些topic量过于大</li>
</ul>
<h3 id="配额-负载均衡"><a href="#配额-负载均衡" class="headerlink" title="配额/负载均衡"></a>配额/负载均衡</h3><ul>
<li>业务短时间内开启多个进程</li>
</ul>
<h3 id="运维成本"><a href="#运维成本" class="headerlink" title="运维成本"></a>运维成本</h3><ul>
<li><p>多处配置文件维护（cluster.conf,burrow.list）</p>
</li>
<li><p>手动进程增添，跨机器之后配置不统一</p>
</li>
<li><p>进程存在哪台机器，未知</p>
</li>
</ul>
<h2 id="最初运维改善"><a href="#最初运维改善" class="headerlink" title="最初运维改善"></a>最初运维改善</h2><ol>
<li><p>可用性监控</p>
</li>
<li><p>运维工具编写</p>
<ul>
<li><p>配置批量增删改查工具</p>
</li>
<li><p>机器整体迁移工具</p>
</li>
</ul>
</li>
</ol>
<h2 id="思考-容器能为我们带来什么？"><a href="#思考-容器能为我们带来什么？" class="headerlink" title="思考-容器能为我们带来什么？"></a>思考-容器能为我们带来什么？</h2><ul>
<li><p>可用性更强<br>  hulk容器有保活功能。挂掉自动拉起</p>
</li>
<li><p>资源配比均衡<br>  不用考虑机器上进程超载状况</p>
</li>
<li><p>增添副本更加方便<br>  有接口，可以直接操作</p>
</li>
<li><p>运维成本更低<br>  迁移，更改配置更加方便</p>
</li>
</ul>
<p>而且各进程之间没有什么数据同步，基本无状态，非常适合容器场景。</p>
<h2 id="容器化面对的问题"><a href="#容器化面对的问题" class="headerlink" title="容器化面对的问题"></a>容器化面对的问题</h2><p><strong>如何实现以下问题</strong></p>
<ol>
<li><p>hdfs授权</p>
</li>
<li><p>配置</p>
</li>
<li><p>监控</p>
</li>
<li><p>动态调整 </p>
</li>
<li><p>无痛迁移</p>
</li>
</ol>
<h2 id="最终实现"><a href="#最终实现" class="headerlink" title="最终实现"></a>最终实现</h2><ul>
<li><p>自动授权</p>
<ul>
<li>[x]系统部配合出授权接口</li>
<li><input checked="" disabled="" type="checkbox"> 我们自己用golang包成工具，嵌入到容器中，每次容器启动的时候自动授权</li>
</ul>
</li>
<li><p>配置存取</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> 从zookeeper迁移到qcm, 制定新的配置模板，由hulk写入到qcm配置中心<br><img src="/media/15737174157081.jpg" alt=""></li>
</ul>
</li>
</ul>
<p> <img src="/media/15737173069750.jpg" alt=""></p>
<pre><code>* [x] 容器读取qcm http接口</code></pre><ul>
<li><p>监控</p>
<ul>
<li><input checked="" disabled="" type="checkbox"> <p>容器主进程自动check服务进程</p>
</li>
<li><input checked="" disabled="" type="checkbox"> <p>根据topic流量和lag情况进行副本动态调整<br><img src="/media/15737168832421.jpg" alt=""></p>
</li>
<li><input checked="" disabled="" type="checkbox"> <p>每次调整之后的结果，包括<em>pod_num</em>,<em>lag情况</em>,<em>partition数量</em>都记录在数据库中，做到有据可查，也能及时发现异常情况<br><img src="/media/15737169589168.jpg" alt=""></p>
</li>
</ul>
</li>
</ul>
<pre><code>* [x] 设置黑名单功能，对异常业务进行隔离</code></pre><ul>
<li>hulk用户无缝迁移<ul>
<li><input checked="" disabled="" type="checkbox"> 使用相同consumer group</li>
<li><input checked="" disabled="" type="checkbox"> hulk 开发配合特征识别新老版本进程（新建走新流程）</li>
</ul>
</li>
</ul>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>其实在这个过程当中工作量具体分配如下：</p>
<table>
<thead>
<tr>
<th>content</th>
<th>工作量/时间 占比</th>
</tr>
</thead>
<tbody><tr>
<td>发现问题</td>
<td>10%</td>
</tr>
<tr>
<td>提出方案</td>
<td>10%</td>
</tr>
<tr>
<td>沟通/跨部门沟通</td>
<td>30%</td>
</tr>
<tr>
<td>优化/确定方案</td>
<td>10%</td>
</tr>
<tr>
<td>上线</td>
<td>30%</td>
</tr>
<tr>
<td>后续问题处理</td>
<td>10%</td>
</tr>
</tbody></table>
<p>所以沟通尤其跨部门沟通也是技术活儿，</p>
<h2 id="ToDo"><a href="#ToDo" class="headerlink" title="ToDo:"></a>ToDo:</h2><ul>
<li><input disabled="" type="checkbox"> 授权优化</li>
<li><input disabled="" type="checkbox"> 不同特征topic配置优化</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2019/03/06/%E6%9C%AD%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2019/03/06/%E6%9C%AD%E8%AE%B0/" class="post-title-link" itemprop="url">札记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-03-06 10:14:40" itemprop="dateCreated datePublished" datetime="2019-03-06T10:14:40+08:00">2019-03-06</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>基本的东西之所以基本，不是因为简单，而是因为重要。</p>
</blockquote>
<hr>
<blockquote>
<p>巴赫抗躁动、海顿抗抑郁、莫扎特抗失眠、贝多芬抗萎靡、柴科夫斯基抗饥饿、马勒抗瞌睡、拉赫玛尼诺夫抗寂寞。最后还必须得指出一个最管用的:布鲁克纳，</p>
</blockquote>
<hr>
<blockquote>
<p>我是个俗气至顶的人，见山是山，见海是海，见花便是花。唯独见了你，云海开始翻涌，江潮开始澎湃，昆虫的小触须挠着全世界的痒。你无需开口，我和天地万物便通通奔向你。</p>
</blockquote>
<hr>
<blockquote>
<p>曾经我自诩半个诗人，见山是深情伟岸，见海是热情澎湃，见花见草信他们皆有故事，云海江潮，虫鸣鸟啼都暗藏情愫。唯独见了你，山川沉默，海面静谧，云海不再翻涌，江潮不再澎湃，花鸟鱼虫被光与尘凝固，世界万籁俱寂，只剩下你。</p>
</blockquote>
<hr>
<blockquote>
<p>有位文豪说得好：「看一个作家的水平，不是看他发表了多少文字，而要看他的废纸篓里扔掉了多少。」我觉得同样的理论适用于编程。好的程序员，他们删掉的代码，比留下来的还要多很多。如果你看见一个人写了很多代码，却没有删掉多少，那他的代码一定有很多垃圾。</p>
</blockquote>
<hr>
<blockquote>
<p>你们对我的百般注解和识读，并不构成万分之一的我，却是一览无遗的你们。</p>
</blockquote>
<hr>
<blockquote>
<p>不被理性升华的愤怒只会成为恶产生的源头.</p>
</blockquote>
<hr>
<blockquote>
<p>关于「情怀」。</p>
</blockquote>
<p>我觉得吧，什么是情，是你对某个事物，某一项工作的投入，你身在其中，你专注你付出，你觉得这个是值得的。而这个怀，就是在这个过程中，你若遇到的事情，合不合你意，你都能装下，能包容，能坚持一直以来的方向。这样在遇到一些选择的时候，你即使心中有其他声音干扰，也仍然能做出正确的抉择。从某种意义上来说，也算是一种信仰吧。有的人说是装逼，其实情怀这东西，每个人都有，只不过大家用的不同罢了。</p>
<hr>
<blockquote>
<p>一只船孤独的航行在海上，它既不寻求幸福，也不逃避幸福，它只是向前航行，底下是沉静碧蓝的大海，而头顶是金色的太阳。 – 莱蒙托夫</p>
</blockquote>
<hr>
<blockquote>
<p>她就像个小公主——站在森林里双臂一张，蝴蝶都飞过来、小鹿都跑过来，森林里的生灵都围着坐着听她唱歌。 </p>
</blockquote>
<hr>
<blockquote>
<p>你要做个不动声色的大人了，不准情绪化，不准偷偷想念，不准回头看，去过自己另外的生活。你要听话，不是所有的鱼都会生活在同一片海里。 – 村上春树</p>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2019/01/14/python%E6%8A%80%E5%B7%A7/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2019/01/14/python%E6%8A%80%E5%B7%A7/" class="post-title-link" itemprop="url">python技巧</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-01-14 10:29:07" itemprop="dateCreated datePublished" datetime="2019-01-14T10:29:07+08:00">2019-01-14</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>无序记录python使用中的技巧，</p>
</blockquote>
<h1 id="centos6-安装python2-7"><a href="#centos6-安装python2-7" class="headerlink" title="centos6 安装python2.7"></a>centos6 安装python2.7</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install -y zlib-devel bzip2-devel openssl-devel xz-libs wget mysql-devel </span><br><span class="line">wget https:&#x2F;&#x2F;www.python.org&#x2F;ftp&#x2F;python&#x2F;2.7.8&#x2F;Python-2.7.8.tgz</span><br><span class="line">tar -zxvf Python-2.7.8.tgz</span><br><span class="line">cd Python-2.7.8</span><br><span class="line">.&#x2F;configure --prefix&#x3D;&#x2F;usr&#x2F;local</span><br><span class="line">make &amp;&amp; make install</span><br><span class="line">curl https:&#x2F;&#x2F;bootstrap.pypa.io&#x2F;get-pip.py -o get-pip.py</span><br><span class="line">&#x2F;usr&#x2F;local&#x2F;bin&#x2F;python2.7 get-pip.py</span><br></pre></td></tr></table></figure>

<h1 id="python-字典比较"><a href="#python-字典比较" class="headerlink" title="python 字典比较"></a>python 字典比较</h1><pre><code>json_tools.diff()</code></pre><h1 id="python-list-filter-过滤list-中含有”topic”的元素，生成一个新的字典"><a href="#python-list-filter-过滤list-中含有”topic”的元素，生成一个新的字典" class="headerlink" title="python list filter (过滤list 中含有”topic”的元素，生成一个新的字典)"></a>python list filter (过滤list 中含有”topic”的元素，生成一个新的字典)</h1><pre><code>list(filter(lambda x: &quot;topic&quot; in x , confs_list)</code></pre><h1 id="判断变量是否存在"><a href="#判断变量是否存在" class="headerlink" title="判断变量是否存在"></a>判断变量是否存在</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">python中检测某个变量是否有定义</span><br><span class="line"></span><br><span class="line">第一种方法使用内置函数locals()： </span><br><span class="line">locals()：获取已定义对象字典</span><br><span class="line"></span><br><span class="line">&#39;testvar&#39;   in   locals().keys()</span><br><span class="line">1</span><br><span class="line">第二种方法使用内置函数dir()： </span><br><span class="line">dir()：获取已定义对象列表</span><br><span class="line"></span><br><span class="line">&#39;testvar&#39;   in   dir()</span><br><span class="line">1</span><br><span class="line">第三种方法使用内置函数vars()： </span><br><span class="line">vars()：获取已定义对象字典</span><br><span class="line"></span><br><span class="line">vars().has_key(&#39;testvar&#39;)</span><br></pre></td></tr></table></figure>

<h1 id="lambda-filter-map"><a href="#lambda-filter-map" class="headerlink" title="lambda, filter, map"></a>lambda, filter, map</h1><h3 id="lambda-匿名函数"><a href="#lambda-匿名函数" class="headerlink" title="lambda 匿名函数"></a>lambda 匿名函数</h3><p>格式： fun_name = lambda x : x+2（表达式)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x&#x3D;lambda x:x*x if x%2&#x3D;&#x3D;0 else x</span><br></pre></td></tr></table></figure>

<h4 id="sort-lambda-按照第三列排序"><a href="#sort-lambda-按照第三列排序" class="headerlink" title="sort lambda (按照第三列排序)"></a>sort lambda (按照第三列排序)</h4><blockquote>
<blockquote>
<blockquote>
<p>l=[(‘b’, ‘atom’, 2), (‘c’, ‘big’, 12), (‘a’, ‘tom’, 21)]<br>l.sort(key=lambda l: (l[2]))<br>l<br>[(‘b’, ‘atom’, 2), (‘c’, ‘big’, 12), (‘a’, ‘tom’, 21)]</p>
</blockquote>
</blockquote>
</blockquote>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/11/27/tumx%E4%BD%BF%E7%94%A8/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/11/27/tumx%E4%BD%BF%E7%94%A8/" class="post-title-link" itemprop="url">tumx使用</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-27 14:53:25" itemprop="dateCreated datePublished" datetime="2018-11-27T14:53:25+08:00">2018-11-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>参考：<br><a href="https://github.com/gpakosz/.tmux">https://github.com/gpakosz/.tmux</a><br><a href="https://www.linkedin.com/pulse/how-i-use-tmux-iterm2-robert-freiberger">https://www.linkedin.com/pulse/how-i-use-tmux-iterm2-robert-freiberger</a><br><a href="http://cenalulu.github.io/linux/tmux/">http://cenalulu.github.io/linux/tmux/</a></p>
<p><img src="/media/15433023443827.jpg" alt=""></p>
<p>操作步骤：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">安装tmux</span><br><span class="line">$ brew install tmux</span><br><span class="line">下载配置文件 （配置文件依赖于powerline-status 需要pip安装）</span><br><span class="line">$ cd</span><br><span class="line">$ git clone https:&#x2F;&#x2F;github.com&#x2F;gpakosz&#x2F;.tmux.git</span><br><span class="line">$ ln -s -f .tmux&#x2F;.tmux.conf</span><br><span class="line">$ cp .tmux&#x2F;.tmux.conf.local .</span><br><span class="line">$ reload 配置 C-a + r</span><br></pre></td></tr></table></figure>

<p>使用方法：</p>
<h1 id="tmux-shortcuts-amp-cheatsheet"><a href="#tmux-shortcuts-amp-cheatsheet" class="headerlink" title="tmux shortcuts &amp; cheatsheet"></a>tmux shortcuts &amp; cheatsheet</h1><p>start new:</p>
<pre><code>tmux</code></pre><p>start new with session name:</p>
<pre><code>tmux new -s myname</code></pre><p>attach:</p>
<pre><code>tmux a  #  (or at, or attach)</code></pre><p>attach to named:</p>
<pre><code>tmux a -t myname</code></pre><p>list sessions:</p>
<pre><code>tmux ls</code></pre><p><a name="killSessions"></a>kill session:</p>
<pre><code>tmux kill-session -t myname</code></pre><p><a name="killAllSessions"></a>Kill all the tmux sessions:</p>
<pre><code>tmux ls | grep : | cut -d. -f1 | awk &apos;{print substr($1, 0, length($1)-1)}&apos; | xargs kill</code></pre><p>In tmux, hit the prefix <code>ctrl+b</code> (my modified prefix is ctrl+a) and then:</p>
<h2 id="Sessions"><a href="#Sessions" class="headerlink" title="Sessions"></a>Sessions</h2><pre><code>:new&lt;CR&gt;  new session
s  list sessions
$  name session</code></pre><h2 id="Windows-tabs"><a href="#Windows-tabs" class="headerlink" title="Windows (tabs)"></a><a name="WindowsTabs"></a>Windows (tabs)</h2><pre><code>c  create window
w  list windows
n  next window
p  previous window
f  find window
,  name window
&amp;  kill window</code></pre><h2 id="Panes-splits"><a href="#Panes-splits" class="headerlink" title="Panes (splits)"></a><a name="PanesSplits"></a>Panes (splits)</h2><pre><code>%  vertical split
&quot;  horizontal split

o  swap panes
q  show pane numbers
x  kill pane
+  break pane into window (e.g. to select text by mouse to copy)
-  restore pane from window
⍽  space - toggle between layouts
&lt;prefix&gt; q (Show pane numbers, when the numbers show up type the key to goto that pane)
&lt;prefix&gt; { (Move the current pane left)
&lt;prefix&gt; } (Move the current pane right)
&lt;prefix&gt; z toggle pane zoom</code></pre><h2 id="Sync-Panes"><a href="#Sync-Panes" class="headerlink" title="Sync Panes"></a><a name="syncPanes"></a>Sync Panes</h2><p>You can do this by switching to the appropriate window, typing your Tmux prefix (commonly Ctrl-B or Ctrl-A) and then a colon to bring up a Tmux command line, and typing:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">:setw synchronize-panes</span><br></pre></td></tr></table></figure>

<p>You can optionally add on or off to specify which state you want; otherwise the option is simply toggled. This option is specific to one window, so it won’t change the way your other sessions or windows operate. When you’re done, toggle it off again by repeating the command. <a href="http://blog.sanctum.geek.nz/sync-tmux-panes/">tip source</a></p>
<h2 id="Resizing-Panes"><a href="#Resizing-Panes" class="headerlink" title="Resizing Panes"></a>Resizing Panes</h2><p>You can also resize panes if you don’t like the layout defaults. I personally rarely need to do this, though it’s handy to know how. Here is the basic syntax to resize panes:</p>
<pre><code>PREFIX : resize-pane -D (Resizes the current pane down)
PREFIX : resize-pane -U (Resizes the current pane upward)
PREFIX : resize-pane -L (Resizes the current pane left)
PREFIX : resize-pane -R (Resizes the current pane right)
PREFIX : resize-pane -D 20 (Resizes the current pane down by 20 cells)
PREFIX : resize-pane -U 20 (Resizes the current pane upward by 20 cells)
PREFIX : resize-pane -L 20 (Resizes the current pane left by 20 cells)
PREFIX : resize-pane -R 20 (Resizes the current pane right by 20 cells)
PREFIX : resize-pane -t 2 20 (Resizes the pane with the id of 2 down by 20 cells)
PREFIX : resize-pane -t -L 20 (Resizes the pane with the id of 2 left by 20 cells)</code></pre><h2 id="Copy-mode"><a href="#Copy-mode" class="headerlink" title="Copy mode:"></a>Copy mode:</h2><p>Pressing PREFIX [ places us in Copy mode. We can then use our movement keys to move our cursor around the screen. By default, the arrow keys work. we set our configuration file to use Vim keys for moving between windows and resizing panes so we wouldn’t have to take our hands off the home row. tmux has a vi mode for working with the buffer as well. To enable it, add this line to .tmux.conf:</p>
<pre><code>setw -g mode-keys vi</code></pre><p>With this option set, we can use h, j, k, and l to move around our buffer.</p>
<p>To get out of Copy mode, we just press the ENTER key. Moving around one character at a time isn’t very efficient. Since we enabled vi mode, we can also use some other visible shortcuts to move around the buffer.</p>
<p>For example, we can use “w” to jump to the next word and “b” to jump back one word. And we can use “f”, followed by any character, to jump to that character on the same line, and “F” to jump backwards on the line.</p>
<pre><code>Function                vi             emacs
Back to indentation     ^              M-m
Clear selection         Escape         C-g
Copy selection          Enter          M-w
Cursor down             j              Down
Cursor left             h              Left
Cursor right            l              Right
Cursor to bottom line   L
Cursor to middle line   M              M-r
Cursor to top line      H              M-R
Cursor up               k              Up
Delete entire line      d              C-u
Delete to end of line   D              C-k
End of line             $              C-e
Goto line               :              g
Half page down          C-d            M-Down
Half page up            C-u            M-Up
Next page               C-f            Page down
Next word               w              M-f
Paste buffer            p              C-y
Previous page           C-b            Page up
Previous word           b              M-b
Quit mode               q              Escape
Scroll down             C-Down or J    C-Down
Scroll up               C-Up or K      C-Up
Search again            n              n
Search backward         ?              C-r
Search forward          /              C-s
Start of line           0              C-a
Start selection         Space          C-Space
Transpose chars                        C-t</code></pre><h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><pre><code>d  detach
t  big clock
?  list shortcuts
:  prompt</code></pre><h2 id="Configurations-Options"><a href="#Configurations-Options" class="headerlink" title="Configurations Options:"></a>Configurations Options:</h2><pre><code># Mouse support - set to on if you want to use the mouse
* setw -g mode-mouse off
* set -g mouse-select-pane off
* set -g mouse-resize-pane off
* set -g mouse-select-window off

# Set the default terminal mode to 256color mode
set -g default-terminal &quot;screen-256color&quot;

# enable activity alerts
setw -g monitor-activity on
set -g visual-activity on

# Center the window list
set -g status-justify centre

# Maximize and restore a pane
unbind Up bind Up new-window -d -n tmp \; swap-pane -s tmp.1 \; select-window -t tmp
unbind Down
bind Down last-window \; swap-pane -s tmp.1 \; kill-window -t tmp</code></pre><h2 id="Notes"><a href="#Notes" class="headerlink" title="Notes:"></a>Notes:</h2><p>操作多个pane</p>
<p><prefix> + : + setw synchronize-panes</p>
<h2 id="Changelog"><a href="#Changelog" class="headerlink" title="Changelog:"></a>Changelog:</h2><ul>
<li>1411143833002 - Added <a href="#PanesSplits">toggle zoom</a> under Panes (splits) section.</li>
<li>1411143833002 - <a href="#syncPanes">Added Sync Panes</a></li>
<li>1414276652677 - <a href="#killAllSessions">Added Kill all tmux sessions </a></li>
<li>1438585211173 - <a href="#WindowsTabs">corrected create and add next and previus thanks to @justinjhendrick</a></li>
</ul>
<h2 id="Request-an-Update"><a href="#Request-an-Update" class="headerlink" title="Request an Update:"></a>Request an Update:</h2><p>We Noticed that our Cheatsheet is growing and people are coloberating to add new tips and tricks, so please tweet to me what would you like to add and let’s make it better!</p>
<h2 id="鼠标模式"><a href="#鼠标模式" class="headerlink" title="鼠标模式"></a>鼠标模式</h2><p><prefix> + m</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/11/12/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/11/12/%E5%88%86%E5%B8%83%E5%BC%8F%E4%B8%80%E8%87%B4%E6%80%A7%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">分布式一致性总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-11-12 20:18:24" itemprop="dateCreated datePublished" datetime="2018-11-12T20:18:24+08:00">2018-11-12</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>分布式系统离不开一致性问题的讨论。哈哈。结合Google总结下</p>
</blockquote>
<p>其中一致性大致分为<code>强一致性</code>，<code>弱一致性</code>，<code>最终一致性</code>。而一致性越强大概率是以牺牲读写效率为前提。</p>
<h1 id="CAP-理论"><a href="#CAP-理论" class="headerlink" title="CAP 理论"></a>CAP 理论</h1><p><strong>C</strong> </p>
<h1 id="Paxos算法"><a href="#Paxos算法" class="headerlink" title="Paxos算法"></a>Paxos算法</h1><h1 id="gossip协议"><a href="#gossip协议" class="headerlink" title="gossip协议"></a>gossip协议</h1><h1 id="raft算法"><a href="#raft算法" class="headerlink" title="raft算法"></a>raft算法</h1>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/09/17/%E7%B3%BB%E7%BB%9Fio%E4%BC%98%E5%8C%96/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/09/17/%E7%B3%BB%E7%BB%9Fio%E4%BC%98%E5%8C%96/" class="post-title-link" itemprop="url">系统io优化</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-09-17 10:10:04" itemprop="dateCreated datePublished" datetime="2018-09-17T10:10:04+08:00">2018-09-17</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>因为kafka集群的问题引发对系统io的相关优化，所以此优化针对kafka等大量io的应用场景。</p>
</blockquote>
<h1 id="IO调度器"><a href="#IO调度器" class="headerlink" title="IO调度器"></a>IO调度器</h1><p>参考： <a href="https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/6/html/performance_tuning_guide/ch06s04s02">https://access.redhat.com/documentation/zh-cn/red_hat_enterprise_linux/6/html/performance_tuning_guide/ch06s04s02</a></p>
<ul>
<li>cfq</li>
</ul>
<blockquote>
<p>centos6 默认是cfq(Completely Fair Queuing), 每个进程维护一个io队列，然后<code>调度器</code>对每个队列进行轮询，相对于每个进程是公平的。每个进程可以设置io读写优先级。</p>
</blockquote>
<ul>
<li>Deadline </li>
</ul>
<blockquote>
<p>对于读写操作有截止时间，对读和写操作用两条不同的队列管理，可以解决读取饥饿的现象。因为操作系统对读请求是同步处理的，写入请求可以异步处理。操作系统可以数据写到内存，然后对IO队列中的请求做合并，提高IO的吞吐量。通过设置read_expire &lt; write_expire时间，避免读取操作处于饥饿调度的状态。对于数据库存储应用，Deadline是最佳的IO Scheduler，甚至很多PCIE卡作为设备内置默认参数。</p>
</blockquote>
<ul>
<li>NOOP</li>
</ul>
<blockquote>
<p>是建立在FIFO调度模型之上的，并合相邻IO请求。Noop容易出现读取操作饥饿现象，使用NOOP调度，需要磁盘有足够的IO能力。对于SSD基于闪存技术存储介质和SAN存储，NOOP也是首选的调度器。</p>
</blockquote>
<h1 id="脏页相关配置"><a href="#脏页相关配置" class="headerlink" title="脏页相关配置"></a>脏页相关配置</h1><blockquote>
<p>系统数据写入磁盘可以异步进行，这样效率可能会更高。对于IO比较大的机器，可以把脏页大小的阈值调到，更多的使用系统内存来优化磁盘写入速度（所谓优化是尽量让io更多顺序的进行，同一时间点只读或者只写，因为磁盘顺序读写的速度很快）.</p>
</blockquote>
<ul>
<li><code>dirty_ratio</code> 系统总内存的百分比，太小导致系统强制脏页写回到磁盘，这个会阻塞系统接受写入请求。</li>
<li><code>dirty_background_ratio</code> 文件系统的写入缓冲区的大小，达到这个百分比时，pdflush进程开始启动，把数据写回到磁盘，但是不影响正常的读写请求。</li>
</ul>
<p>但是调大脏页率有会带来数据丢失的危险，要有所取舍。</p>
<p>所以我们也可以继续调整下面两个参数</p>
<ul>
<li><p>dirty_writeback_centisecs，控制 pdflush/flush/kdmflush等进程的唤醒时间。默认30s</p>
</li>
<li><p>dirty_expire_centisecs，控制dirty page刷盘时间点。默认5s</p>
</li>
</ul>
<p>减小这两个参数可以使脏页尽快落盘，避免数据丢失，也可解决 io spike 现象。同时io_await也会下降。</p>
<h1 id="文件系统"><a href="#文件系统" class="headerlink" title="文件系统"></a>文件系统</h1><p><code>做了lvm的机器io性能会下降，所以用来频繁io的机器， 最好不要用lvm。</code></p>
<p>一般会选用xfs，因为Ext4最大只支持16T分区,xfs可以到100T+,顺序读写性能也更好一点，更适合操作大文件。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://fanquqi.github.io/2018/08/13/promethrus%E8%AE%B0%E5%BD%95/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="fanquqi.github.io/images/avatar.gif">
      <meta itemprop="name" content="fanquqi">
      <meta itemprop="description" content="Raise my flag to the new age.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="fix u dream">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="fanquqi.github.io/2018/08/13/promethrus%E8%AE%B0%E5%BD%95/" class="post-title-link" itemprop="url">promethrus记录</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2018-08-13 15:28:06" itemprop="dateCreated datePublished" datetime="2018-08-13T15:28:06+08:00">2018-08-13</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-21 20:56:04" itemprop="dateModified" datetime="2020-05-21T20:56:04+08:00">2020-05-21</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <blockquote>
<p>记录一些关键问题点，不是部署文档，不是部署文档。</p>
</blockquote>
<h1 id="数据采集类型"><a href="#数据采集类型" class="headerlink" title="数据采集类型"></a>数据采集类型</h1><ul>
<li><p><strong>counter</strong></p>
</li>
<li><p><strong>gauge</strong></p>
</li>
</ul>
<p><strong>查询语法</strong></p>
<h1 id="函数使用"><a href="#函数使用" class="headerlink" title="函数使用"></a>函数使用</h1><h1 id="AlertManager"><a href="#AlertManager" class="headerlink" title="AlertManager"></a>AlertManager</h1><blockquote>
<p>报警组件使用，</p>
</blockquote>
<h2 id="alertmanager-高可用"><a href="#alertmanager-高可用" class="headerlink" title="alertmanager 高可用"></a>alertmanager 高可用</h2><blockquote>
<p>alertmanager 高可用模式 基于gossip机制同步告警状态，</p>
</blockquote>
<h1 id="nginx-反向代理"><a href="#nginx-反向代理" class="headerlink" title="nginx 反向代理"></a>nginx 反向代理</h1><blockquote>
<p>prometheus 官方推荐的登录验证方式为 <strong>basic auth</strong> 我们可以借助强大的nginx来实现。 把数据接口加上验证，这样监控数据就不会随意被内网的同事们看到了。。</p>
</blockquote>
<h2 id="basic-auth-配置"><a href="#basic-auth-配置" class="headerlink" title="basic auth 配置"></a>basic auth 配置</h2><p>使用<code>htpasswd</code>生成用户名密码</p>
<p>“””<br>htpasswd -c /usr/local/nginx/conf/.htpasswd user1<br>“””</p>
<p><strong>nginx配置文件</strong></p>
<p>“””</p>
<pre><code>server {
    listen       8081;
    server_name  localhost;


    location / {
        auth_basic           &quot;Prometheus&quot;;
        auth_basic_user_file /usr/local/nginx/conf/.htpasswd;
        autoindex on;
        proxy_pass        http://127.0.0.1:6789/;
    }
...
}</code></pre><p>“””</p>
<p>prometheus启动命令调整为</p>
<p>“””<br>/usr/local/prometheus/prometheus –config.file=/usr/local/prometheus/prometheus.yml –log.level=info  –web.enable-admin-api  –web.listen-address=127.0.0.1:6789<br>“””</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="fanquqi.github.io/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="fanquqi.github.io/page/8/">8</a><a class="extend next" rel="next" href="fanquqi.github.io/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">fanquqi</p>
  <div class="site-description" itemprop="description">Raise my flag to the new age.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="fanquqi.github.io/archives/">
        
          <span class="site-state-item-count">73</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">分类</span>
      </div>
      <div class="site-state-item site-state-tags">
        <span class="site-state-item-count">47</span>
        <span class="site-state-item-name">标签</span>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">fanquqi</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://muse.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="fanquqi.github.io/lib/anime.min.js"></script>
  <script src="fanquqi.github.io/lib/velocity/velocity.min.js"></script>
  <script src="fanquqi.github.io/lib/velocity/velocity.ui.min.js"></script>

<script src="fanquqi.github.io/js/utils.js"></script>

<script src="fanquqi.github.io/js/motion.js"></script>


<script src="fanquqi.github.io/js/schemes/muse.js"></script>


<script src="fanquqi.github.io/js/next-boot.js"></script>




  















  

  

</body>
</html>
